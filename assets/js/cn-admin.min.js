jQuery(document).ready(function(a){var f=a(document),h={maps:{},addMap:function(a){if(!this.hasMap(a)){var b=L.map("map-"+a);b.attributionControl.setPrefix("");var c=cnMap.basemapProviders[cnMap.basemapDefault];switch(c.group){case "google":c=L.gridLayer.googleMutant({type:c.type,attribution:c.attribution});break;default:c=L.tileLayer(c.tileLayer,{attribution:c.attribution,minZoom:1,maxZoom:19})}c.addTo(b);c=new L.LayerGroup;c.addTo(b);this.maps[a]={id:a,map:b,pins:c,addPin:function(a){return L.marker(a,
{draggable:!0,autoPan:!0}).addTo(this.pins)},clearPins:function(){this.pins.clearLayers()}}}return this.maps[a]},hasMap:function(a){return this.maps.hasOwnProperty(a)},getMap:function(a){if(this.hasMap(a))return this.maps[a]}},e={map:null,init:function(){var b;1==a("input[name=entry_type]").length?b=a("input[name=entry_type]").val():1<a("input[name=entry_type]").length&&(b=a("input[name=entry_type]:checked").val());switch(b){case "individual":this.show(b);break;case "organization":this.show(b);break;
case "family":this.show(b)}a("#submitdiv").on("click","input[name=entry_type][value=individual]",function(){e.show("individual")});a("#submitdiv").on("click","input[name=entry_type][value=organization]",function(){e.show("organization")});a("#submitdiv").on("click","input[name=entry_type][value=family]",function(){e.show("family")});a("#cn-metabox-section-family").on("click","#add-relation",function(){e.relation()});a(".postbox").on("click","a.cn-add.cn-button",function(b){e.add(a(this));b.preventDefault()});
a(".postbox").on("click","a.cn-remove.cn-button",function(b){e.remove(a(this));b.preventDefault()});a.fn.chosen&&a(".cn-enhanced-select").chosen();if(a.fn.datepicker)a("body").on("focus",".cn-datepicker",function(){e.datepicker(a(this))});a("#metabox-address").on("click","a.geocode.button",function(b){e.geocode(a(this));b.preventDefault()});window.FileReader&&window.File&&window.FileList&&window.Blob&&a('input[name="original_image"], input[name="original_logo"]').bind("change",function(){var b=a('input[name="original_image"]'),
c=a('input[name="original_logo"]');if(cn_string.imageMaxFileSize<this.files[0].size){var d=a(this).attr("name"),e="original_image"==a(this).attr("name")?b.clone(!0):c.clone(!0);alert(cn_string.imageMaxFileSizeExceeded);"original_image"==d?b.replaceWith(e):c.replaceWith(e)}});a("#metabox-meta").on("click","#newmeta-submit",function(a){e.add_meta();a.preventDefault()});a("#metabox-meta").on("click",'input[name^="deletemeta"]',function(b){e.delete_meta(a(this));b.preventDefault()});a("#metabox-meta").on("click",
"#enternew, #cancelnew",function(a){e.clear_meta();a.preventDefault()});a("#cn-relations").sortable();var d=a(".categorydiv div.tabs-panel#category-all"),c=cn_string.categoryDiv.height;a(d).resizable({maxWidth:Math.floor(d.width()),minWidth:Math.floor(d.width()),create:function(b,d){var e=a(this);e.css({height:c,width:"inherit"});e.children(".ui-icon").css("background","url(images/resize.gif)")},stop:function(a,b){window.wp.ajax.send("set_category_div_height",{success:function(a){},error:function(a){},
data:{height:d.height(),_ajax_nonce:cn_string.categoryDiv.nonce}})}}).css({"max-height":"none"});e.validate(a("#cn-form"))},show:function(b){a("#metabox-name .cn-metabox-section").slideUp().promise().always(function(){switch(b){case "individual":a("input[name=first_name], input[name=last_name]").addClass("required");a("input[name=organization]").removeClass("required error").addClass("invalid");a("input[name=family_name]").removeClass("required error").addClass("invalid");a("#metabox-name .cn-metabox-section.cn-individual").slideDown();
break;case "organization":a("input[name=organization]").addClass("required");a("input[name=first_name], input[name=last_name]").removeClass("required error").addClass("invalid");a("input[name=family_name]").removeClass("required error").addClass("invalid");a("#metabox-name .cn-metabox-section.cn-organization").slideDown();break;case "family":a("input[name=family_name]").addClass("required"),a("input[name=first_name], input[name=last_name]").removeClass("required error").addClass("invalid"),a("input[name=organization]").removeClass("required error").addClass("invalid"),
a("#metabox-name .cn-metabox-section.cn-family").slideDown()}});f.trigger("entry-type-selected",b)},add:function(b){var d=b.attr("data-type");b="#"+b.attr("data-container");var c=a("#"+d+"-template").text(),e=Math.floor(Math.random()*(new Date).getTime());c=c.replace(RegExp("::FIELD::","gi"),e);a(b).append('<div class="widget '+d+'" id="'+d+"-row-"+e+'" style="display: none;">'+c+"</div>");a("#"+d+"-row-"+e).slideDown().find(".cn-enhanced-select").chosen();f.trigger("entry-field-type-added",d)},remove:function(b){var d=
b.attr("data-token"),c="#"+b.attr("data-type")+"-row-"+d;a(c).slideUp("fast",function(){a(c).remove()})},add_meta:function(){var b=a("#list-table").find("tbody tr:last-child").clone(),d="-1"!==a("#metakeyselect").val()?a("#metakeyselect").val():a("#metakeyinput").val(),c=a("#metavalue").val();a("#metakeyinput, #metavalue").val("");a("#metakeyselect option").eq(0).prop("selected",!0);b.find("input, textarea").attr("id",function(a,b){return b.replace(/(\d+)/,function(a,b){return Number(b)+1})});b.find("input, textarea").attr("name",
function(a,b){return b.replace(/(\d+)/,function(a,b){return Number(b)+1})});b.find("label").attr("for",function(a,b){return b.replace(/(\d+)/,function(a,b){return Number(b)+1})});b.find('input[name^="newmeta"]').val(d);b.find("textarea").val(c);a("#list-table").is(":visible")||a("#list-table").toggle();b.toggle();a("#the-list").append(b)},delete_meta:function(b){b.closest("tr").toggle().find("textarea").val("::DELETED::");a("#list-table").is(":visible")&&0==a("#list-table tbody tr:visible").length&&
a("#list-table").toggle()},clear_meta:function(){a("#metakeyinput, #metakeyselect, #enternew, #cancelnew").toggle();a("#metakeyselect option").eq(0).prop("selected",!0);a("#metakeyinput").val("")},chosen:function(a){a.chosen()},datepicker:function(a){a.datepicker({changeMonth:!0,changeYear:!0,showOtherMonths:!0,selectOtherMonths:!0,yearRange:"c-100:c+10",dateFormat:"mm/dd/yy"})},geocode:function(b){var d={},c=b.attr("data-uid");d.line_1=a("input[name=address\\["+c+"\\]\\[line_1\\]]").val();d.city=
a("input[name=address\\["+c+"\\]\\[city\\]]").val();d.state=a("input[name=address\\["+c+"\\]\\[state\\]]").val();d.zipcode=a("input[name=address\\["+c+"\\]\\[zipcode\\]]").val();b=a("#cn-address\\["+c+"\\]\\[country\\]");b.is("input")?d.country=b.val():b.is("select")&&(d.country=b.find(":selected").val());d=Object.keys(d).map(function(a){return d[a]}).filter(Boolean).join(" ");console.log(d);a("#map-"+c).fadeIn("slow",function(){var b=a("input[name=address\\["+c+"\\]\\[latitude\\]]"),e=a("input[name=address\\["+
c+"\\]\\[longitude\\]]"),f=h.addMap(c);switch(cnMap.geocoderDefault){case "google":var g=new L.Control.Geocoder.GoogleNative;break;default:g=new L.Control.Geocoder.Nominatim}g.geocode(d,function(a){console.log(a);this.clearPins();a&&a.length&&(a=a[0],b.val(a.center.lat),e.val(a.center.lng),this.map.setView(a.center,16),this.addPin(a.center).on("dragend",function(a){b.val(this.getLatLng().lat);e.val(this.getLatLng().lng)}))},f)})},relation:function(){var b=a("#cn-relation-template").text(),d=Math.floor(Math.random()*
(new Date).getTime());b=b.replace(RegExp("::FIELD::","gi"),d);a("#cn-relations").append('<li id="relation-row-'+d+'" class="cn-relation" style="display: none;"><i class="fa fa-sort"></i> '+b+'<a href="#" class="cn-remove cn-button button button-warning" data-type="relation" data-token="'+d+'">Remove</a></li>');a("#relation-row-"+d).slideDown();a(".cn-enhanced-select").chosen()},validate:function(a){a.validate({errorPlacement:function(a,b){},ignore:'ul.chosen-choices li.search-field input, textarea[id$="template"]'})}};
e.init();a("a.detailsbutton").click(function(){var b=a(this);b.text(b.text()==cn_string.showDetails?cn_string.hideDetails:cn_string.showDetails).attr("title",b.attr("title")==cn_string.showDetailsTitle?cn_string.hideDetailsTitle:cn_string.showDetailsTitle);a(".child-"+this.id).each(function(b,c){a(c).toggle()})})});