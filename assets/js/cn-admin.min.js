jQuery(document).ready((function($){var $document=$(document),maps={maps:{},addMap:function(id){if(!this.hasMap(id)){var map=L.map("map-"+id);map.attributionControl.setPrefix("");var provider=cnMap.basemapProviders[cnMap.basemapDefault];switch(provider.group){case"google":var tiles=L.gridLayer.googleMutant({type:provider.type,attribution:provider.attribution});break;default:var tiles=L.tileLayer(provider.tileLayer,{attribution:provider.attribution,minZoom:1,maxZoom:19})}tiles.addTo(map);var pins=new L.LayerGroup;pins.addTo(map),this.maps[id]={id:id,map:map,pins:pins,addPin:function(LatLng){return L.marker(LatLng,{draggable:!0,autoPan:!0}).addTo(this.pins)},clearPins:function(){this.pins.clearLayers()}}}return this.maps[id]},hasMap:function(id){return this.maps.hasOwnProperty(id)},getMap:function(id){if(this.hasMap(id))return this.maps[id]}},CN_Form={map:null,init:function(){var type;switch(1==$("input[name=entry_type]").length?type=$("input[name=entry_type]").val():$("input[name=entry_type]").length>1&&(type=$("input[name=entry_type]:checked").val()),type){case"individual":case"organization":case"family":this.show(type)}$("#submitdiv").on("click","input[name=entry_type][value=individual]",(function(){CN_Form.show("individual")})),$("#submitdiv").on("click","input[name=entry_type][value=organization]",(function(){CN_Form.show("organization")})),$("#submitdiv").on("click","input[name=entry_type][value=family]",(function(){CN_Form.show("family")})),$("#cn-metabox-section-family").on("click","#add-relation",(function(){CN_Form.relation()})),$(".postbox").on("click","a.cn-add.cn-button",(function(e){CN_Form.add($(this)),e.preventDefault()})),$(".postbox").on("click","a.cn-remove.cn-button",(function(e){CN_Form.remove($(this)),e.preventDefault()})),$.fn.chosen&&$(".cn-enhanced-select").chosen(),$.fn.datepicker&&$("body").on("focus",".cn-datepicker",(function(e){CN_Form.datepicker($(this)),e.preventDefault()})),$("#metabox-address").on("click","a.geocode.button",(function(e){CN_Form.geocode($(this)),e.preventDefault()})),window.FileReader&&window.File&&window.FileList&&window.Blob&&$('input[name="original_image"], input[name="original_logo"]').on("change",(function(){var imageField=$('input[name="original_image"]'),logoField=$('input[name="original_logo"]');if(cn_string.imageMaxFileSize<this.files[0].size){var name=$(this).attr("name"),clone="original_image"==$(this).attr("name")?imageField.clone(!0):logoField.clone(!0);alert(cn_string.imageMaxFileSizeExceeded),"original_image"==name?imageField.replaceWith(clone):logoField.replaceWith(clone)}})),$("#metabox-meta").on("click","#newmeta-submit",(function(e){CN_Form.add_meta(),e.preventDefault()})),$("#metabox-meta").on("click",'input[name^="deletemeta"]',(function(e){CN_Form.delete_meta($(this)),e.preventDefault()})),$("#metabox-meta").on("click","#enternew, #cancelnew",(function(e){CN_Form.clear_meta(),e.preventDefault()})),$("#cn-relations").sortable();var categorydiv=$("#taxonomy-category"),categorydivHeight=cn_string.categoryDiv.height;$(categorydiv).resizable({maxWidth:Math.floor(categorydiv.width()),minWidth:Math.floor(categorydiv.width()),create:function(event,ui){var $this=$(this);$this.css({height:categorydivHeight,width:"inherit"}),$this.children(".ui-icon").css("background","url(images/resize.gif)")},stop:function(event,ui){var wp;window.wp.ajax.send("set_category_div_height",{success:function(response){},error:function(response){},data:{height:categorydiv.height(),_ajax_nonce:cn_string.categoryDiv.nonce}})}}).css({"max-height":"none"}),CN_Form.validate($("#cn-form"))},show:function(type){$("#metabox-name .cn-metabox-section").slideUp().promise().always((function(){switch(type){case"individual":$("input[name=first_name], input[name=last_name]").addClass("required"),$("input[name=organization]").removeClass("required error").addClass("invalid"),$("input[name=family_name]").removeClass("required error").addClass("invalid"),$("#metabox-name .cn-metabox-section.cn-individual").slideDown();break;case"organization":$("input[name=organization]").addClass("required"),$("input[name=first_name], input[name=last_name]").removeClass("required error").addClass("invalid"),$("input[name=family_name]").removeClass("required error").addClass("invalid"),$("#metabox-name .cn-metabox-section.cn-organization").slideDown();break;case"family":$("input[name=family_name]").addClass("required"),$("input[name=first_name], input[name=last_name]").removeClass("required error").addClass("invalid"),$("input[name=organization]").removeClass("required error").addClass("invalid"),$("#metabox-name .cn-metabox-section.cn-family").slideDown()}})),$document.trigger("entry-type-selected",type)},add:function(button){var type=button.attr("data-type"),container="#"+button.attr("data-container"),id,template=$("#"+type+"-template").text(),d=new Date,token=Math.floor(Math.random()*d.getTime());template=template.replace(new RegExp("::FIELD::","gi"),token),$(container).append('<div class="widget '+type+'" id="'+type+"-row-"+token+'" style="display: none;">'+template+"</div>"),$("#"+type+"-row-"+token).slideDown().find(".cn-enhanced-select").chosen(),$document.trigger("entry-field-type-added",type)},remove:function(button){var token=button.attr("data-token"),type,id="#"+button.attr("data-type")+"-row-"+token;$(id).slideUp("fast",(function(){$(id).remove()}))},add_meta:function(){var row,clone=$("#list-table").find("tbody tr:last-child").clone(),key="-1"!==$("#metakeyselect").val()?$("#metakeyselect").val():$("#metakeyinput").val(),value=$("#metavalue").val();$("#metakeyinput, #metavalue").val(""),$("#metakeyselect option").eq(0).prop("selected",!0),clone.find("input, textarea").attr("id",(function(index,id){return id.replace(/(\d+)/,(function(fullMatch,n){return Number(n)+1}))})),clone.find("input, textarea").attr("name",(function(index,name){return name.replace(/(\d+)/,(function(fullMatch,n){return Number(n)+1}))})),clone.find("label").attr("for",(function(index,label){return label.replace(/(\d+)/,(function(fullMatch,n){return Number(n)+1}))})),clone.find('input[name^="newmeta"]').val(key),clone.find("textarea").val(value),$("#list-table").is(":visible")||$("#list-table").toggle(),clone.toggle(),$("#the-list").append(clone)},delete_meta:function(row){var tr;row.closest("tr").toggle().find("textarea").val("::DELETED::"),$("#list-table").is(":visible")&&0==$("#list-table tbody tr:visible").length&&$("#list-table").toggle()},clear_meta:function(){$("#metakeyinput, #metakeyselect, #enternew, #cancelnew").toggle(),$("#metakeyselect option").eq(0).prop("selected",!0),$("#metakeyinput").val("")},chosen:function(field){field.chosen()},datepicker:function(field){field.datepicker({changeMonth:!0,changeYear:!0,showOtherMonths:!0,selectOtherMonths:!0,yearRange:"c-100:c+10",dateFormat:"yy-mm-dd"}).keydown(!1)},geocode:function(field){var address=Object(),uid=field.attr("data-uid");address.line_1=$("input[name=address\\["+uid+"\\]\\[line_1\\]]").val(),address.city=$("input[name=address\\["+uid+"\\]\\[city\\]]").val(),address.state=$("input[name=address\\["+uid+"\\]\\[state\\]]").val(),address.zipcode=$("input[name=address\\["+uid+"\\]\\[zipcode\\]]").val();var country=$("#cn-address\\["+uid+"\\]\\[country\\]");country.is("input")?address.country=country.val():country.is("select")&&(address.country=country.find(":selected").val()),address=Object.keys(address).map((function(e){return address[e]})).filter(Boolean).join(" "),console.log(address),$("#map-"+uid).fadeIn("slow",(function(){var latInput=$("input[name=address\\["+uid+"\\]\\[latitude\\]]"),lngInput=$("input[name=address\\["+uid+"\\]\\[longitude\\]]"),map=maps.addMap(uid);switch(cnMap.geocoderDefault){case"google":var geocoder=new L.Control.Geocoder.GoogleNative;break;default:var geocoder=new L.Control.Geocoder.Nominatim}geocoder.geocode(address,(function(results){if(console.log(results),this.clearPins(),results&&results.length){var location=results[0],marker;latInput.val(location.center.lat),lngInput.val(location.center.lng),this.map.setView(location.center,16),this.addPin(location.center).on("dragend",(function(e){latInput.val(this.getLatLng().lat),lngInput.val(this.getLatLng().lng)}))}}),map)}))},relation:function(){var template=$("#cn-relation-template").text(),d=new Date,token=Math.floor(Math.random()*d.getTime());template=template.replace(new RegExp("::FIELD::","gi"),token),$("#cn-relations").append('<li id="relation-row-'+token+'" class="cn-relation" style="display: none;"><i class="fa fa-sort"></i> '+template+'<a href="#" class="cn-remove cn-button button button-warning" data-type="relation" data-token="'+token+'">Remove</a></li>'),$("#relation-row-"+token).slideDown(),$(".cn-enhanced-select").chosen()},validate:function(form){form.validate({errorPlacement:function(error,element){},ignore:'ul.chosen-choices li.search-field input, textarea[id$="template"]'})}};function cnFormatBytesTo(pBytes,pUnits){if(0==pBytes)return"0 Bytes";if(1==pBytes)return"1 Byte";if(-1==pBytes)return"-1 Byte";var bytes=Math.abs(pBytes);if(pUnits&&pUnits.toLowerCase()&&"si"==pUnits.toLowerCase())var orderOfMagnitude=Math.pow(10,3),abbreviations=["Bytes","kB","MB","GB","TB","PB","EB","ZB","YB"];else var orderOfMagnitude=Math.pow(2,10),abbreviations=["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];var i=Math.floor(Math.log(bytes)/Math.log(orderOfMagnitude)),result=bytes/Math.pow(orderOfMagnitude,i);return pBytes<0&&(result*=-1),result>=99.995||0==i?result.toFixed(0)+" "+abbreviations[i]:result.toFixed(2)+" "+abbreviations[i]}CN_Form.init(),$("a.detailsbutton").on("click",(function(){var $this=$(this);$this.text($this.text()==cn_string.showDetails?cn_string.hideDetails:cn_string.showDetails).attr("title",$this.attr("title")==cn_string.showDetailsTitle?cn_string.hideDetailsTitle:cn_string.showDetailsTitle),$(".child-"+this.id).each((function(i,elem){$(elem).toggle()}))}))}));