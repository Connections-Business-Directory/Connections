jQuery(document).ready(function(e){var t=e(document),n={maps:{},addMap:function(e){if(!this.hasMap(e)){var t=L.map("map-"+e);t.attributionControl.setPrefix("");var n=cnMap.basemapProviders[cnMap.basemapDefault];switch(n.group){case"google":var a=L.gridLayer.googleMutant({type:n.type,attribution:n.attribution});break;default:a=L.tileLayer(n.tileLayer,{attribution:n.attribution,minZoom:1,maxZoom:19})}a.addTo(t);var i=new L.LayerGroup;i.addTo(t),this.maps[e]={id:e,map:t,pins:i,addPin:function(e){return L.marker(e,{draggable:!0,autoPan:!0}).addTo(this.pins)},clearPins:function(){this.pins.clearLayers()}}}return this.maps[e]},hasMap:function(e){return this.maps.hasOwnProperty(e)},getMap:function(e){if(this.hasMap(e))return this.maps[e]}},a={map:null,init:function(){var t;switch(1==e("input[name=entry_type]").length?t=e("input[name=entry_type]").val():e("input[name=entry_type]").length>1&&(t=e("input[name=entry_type]:checked").val()),t){case"individual":case"organization":case"family":this.show(t)}e("#submitdiv").on("click","input[name=entry_type][value=individual]",function(){a.show("individual")}),e("#submitdiv").on("click","input[name=entry_type][value=organization]",function(){a.show("organization")}),e("#submitdiv").on("click","input[name=entry_type][value=family]",function(){a.show("family")}),e("#cn-metabox-section-family").on("click","#add-relation",function(){a.relation()}),e(".postbox").on("click","a.cn-add.cn-button",function(t){a.add(e(this)),t.preventDefault()}),e(".postbox").on("click","a.cn-remove.cn-button",function(t){a.remove(e(this)),t.preventDefault()}),e.fn.chosen&&e(".cn-enhanced-select").chosen(),e.fn.datepicker&&e("body").on("focus",".cn-datepicker",function(t){a.datepicker(e(this)),t.preventDefault()}),e("#metabox-address").on("click","a.geocode.button",function(t){a.geocode(e(this)),t.preventDefault()}),window.FileReader&&window.File&&window.FileList&&window.Blob&&e('input[name="original_image"], input[name="original_logo"]').on("change",function(){var t=e('input[name="original_image"]'),n=e('input[name="original_logo"]');if(cn_string.imageMaxFileSize<this.files[0].size){var a=e(this).attr("name"),i="original_image"==e(this).attr("name")?t.clone(!0):n.clone(!0);alert(cn_string.imageMaxFileSizeExceeded),"original_image"==a?t.replaceWith(i):n.replaceWith(i)}}),e("#metabox-meta").on("click","#newmeta-submit",function(e){a.add_meta(),e.preventDefault()}),e("#metabox-meta").on("click",'input[name^="deletemeta"]',function(t){a.delete_meta(e(this)),t.preventDefault()}),e("#metabox-meta").on("click","#enternew, #cancelnew",function(e){a.clear_meta(),e.preventDefault()}),e("#cn-relations").sortable();var n=e("#taxonomy-category"),i=cn_string.categoryDiv.height;e(n).resizable({maxWidth:Math.floor(n.width()),minWidth:Math.floor(n.width()),create:function(t,n){var a=e(this);a.css({height:i,width:"inherit"}),a.children(".ui-icon").css("background","url(images/resize.gif)")},stop:function(e,t){var a=window.wp;a.ajax.send("set_category_div_height",{success:function(e){},error:function(e){},data:{height:n.height(),_cnonce:cn_string.categoryDiv._cnonce}})}}).css({"max-height":"none"}),a.validate(e("#cn-form"))},show:function(n){e("#metabox-name .cn-metabox-section").slideUp().promise().always(function(){switch(n){case"individual":e("input[name=first_name], input[name=last_name]").addClass("required"),e("input[name=organization]").removeClass("required error").addClass("invalid"),e("input[name=family_name]").removeClass("required error").addClass("invalid"),e("#metabox-name .cn-metabox-section.cn-individual").slideDown();break;case"organization":e("input[name=organization]").addClass("required"),e("input[name=first_name], input[name=last_name]").removeClass("required error").addClass("invalid"),e("input[name=family_name]").removeClass("required error").addClass("invalid"),e("#metabox-name .cn-metabox-section.cn-organization").slideDown();break;case"family":e("input[name=family_name]").addClass("required"),e("input[name=first_name], input[name=last_name]").removeClass("required error").addClass("invalid"),e("input[name=organization]").removeClass("required error").addClass("invalid"),e("#metabox-name .cn-metabox-section.cn-family").slideDown()}}),t.trigger("entry-type-selected",n)},add:function(n){var a=n.attr("data-type"),i="#"+n.attr("data-container"),o="#"+a+"-template",r=e(o).text(),l=new Date,c=Math.floor(Math.random()*l.getTime());r=r.replace(new RegExp("::FIELD::","gi"),c),e(i).append('<div class="widget '+a+'" id="'+a+"-row-"+c+'" style="display: none;">'+r+"</div>"),e("#"+a+"-row-"+c).slideDown().find(".cn-enhanced-select").chosen(),t.trigger("entry-field-type-added",a)},remove:function(t){var n=t.attr("data-token"),a=t.attr("data-type"),i="#"+a+"-row-"+n;e(i).slideUp("fast",function(){e(i).remove()})},add_meta:function(){var t=e("#list-table").find("tbody tr:last-child"),n=t.clone(),a="-1"!==e("#metakeyselect").val()?e("#metakeyselect").val():e("#metakeyinput").val(),i=e("#metavalue").val();e("#metakeyinput, #metavalue").val(""),e("#metakeyselect option").eq(0).prop("selected",!0),n.find("input, textarea").attr("id",function(e,t){return t.replace(/(\d+)/,function(e,t){return Number(t)+1})}),n.find("input, textarea").attr("name",function(e,t){return t.replace(/(\d+)/,function(e,t){return Number(t)+1})}),n.find("label").attr("for",function(e,t){return t.replace(/(\d+)/,function(e,t){return Number(t)+1})}),n.find('input[name^="newmeta"]').val(a),n.find("textarea").val(i),e("#list-table").is(":visible")||e("#list-table").toggle(),n.toggle(),e("#the-list").append(n)},delete_meta:function(t){var n=t.closest("tr").toggle();n.find("textarea").val("::DELETED::"),e("#list-table").is(":visible")&&0==e("#list-table tbody tr:visible").length&&e("#list-table").toggle()},clear_meta:function(){e("#metakeyinput, #metakeyselect, #enternew, #cancelnew").toggle(),e("#metakeyselect option").eq(0).prop("selected",!0),e("#metakeyinput").val("")},chosen:function(e){e.chosen()},datepicker:function(e){e.datepicker({changeMonth:!0,changeYear:!0,showOtherMonths:!0,selectOtherMonths:!0,yearRange:"c-100:c+10",dateFormat:"yy-mm-dd"}).keydown(!1)},geocode:function(t){var a=Object(),i=t.attr("data-uid");a.line_1=e("input[name=address\\["+i+"\\]\\[line_1\\]]").val(),a.city=e("input[name=address\\["+i+"\\]\\[city\\]]").val(),a.state=e("input[name=address\\["+i+"\\]\\[state\\]]").val(),a.zipcode=e("input[name=address\\["+i+"\\]\\[zipcode\\]]").val();var o=e("#cn-address\\["+i+"\\]\\[country\\]");o.is("input")?a.country=o.val():o.is("select")&&(a.country=o.find(":selected").val()),a=Object.keys(a).map(function(e){return a[e]}).filter(Boolean).join(" "),console.log(a),e("#map-"+i).fadeIn("slow",function(){var t=e("input[name=address\\["+i+"\\]\\[latitude\\]]"),o=e("input[name=address\\["+i+"\\]\\[longitude\\]]"),r=n.addMap(i);switch(cnMap.geocoderDefault){case"google":var l=new L.Control.Geocoder.GoogleNative;break;default:l=new L.Control.Geocoder.Nominatim}l.geocode(a,function(e){if(console.log(e),this.clearPins(),e&&e.length){var n=e[0];t.val(n.center.lat),o.val(n.center.lng),this.map.setView(n.center,16);var a=this.addPin(n.center);a.on("dragend",function(e){t.val(this.getLatLng().lat),o.val(this.getLatLng().lng)})}},r)})},relation:function(){var t=e("#cn-relation-template").text(),n=new Date,a=Math.floor(Math.random()*n.getTime());t=t.replace(new RegExp("::FIELD::","gi"),a),e("#cn-relations").append('<li id="relation-row-'+a+'" class="cn-relation" style="display: none;"><i class="fa fa-sort"></i> '+t+'<a href="#" class="cn-remove cn-button button button-warning" data-type="relation" data-token="'+a+'">Remove</a></li>'),e("#relation-row-"+a).slideDown(),e(".cn-enhanced-select").chosen()},validate:function(e){e.validate({errorPlacement:function(e,t){},ignore:'ul.chosen-choices li.search-field input, textarea[id$="template"]'})}};a.init(),e("a.detailsbutton").on("click",function(){var t=e(this);t.text(t.text()==cn_string.showDetails?cn_string.hideDetails:cn_string.showDetails).attr("title",t.attr("title")==cn_string.showDetailsTitle?cn_string.hideDetailsTitle:cn_string.showDetailsTitle),e(".child-"+this.id).each(function(t,n){e(n).toggle()})}),e('input[id="connections_uninstall[maybe_uninstall]"]').on("click",function(){const t=e(this),n=t.is(":checked");n&&(confirm("If you decide to delete the plugin, all the directory data associated with it will also be deleted permanently. This action cannot be undone, so please make sure you have backed up your important data before deleting the plugin.")||t.prop("checked",!1))})});