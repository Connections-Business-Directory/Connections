jQuery(document).ready((function($){var CN_CSV_Import={init:function(){var self=this;$(".cn-import-form").ajaxForm({beforeSubmit:this.beforeSubmit,success:this.success,complete:this.complete,dataType:"json",error:this.error})},beforeSubmit:function(arr,form,options){var submit=form.find('.cn-upload-file input[type="submit"]');if(!submit.hasClass("button-disabled"))return submit.addClass("button-disabled").prop("disabled",!0),form.find(".status").remove(),!0},success:function(responseText,textStatus,xhr,form){},complete:function(xhr,textStatus){var html=window.wp.html,response=jQuery.parseJSON(xhr.responseText);if(response.success){var form=$("#"+response.data.form.id),submit=form.find('input[type="submit"]');submit.removeClass("button-disabled").prop("disabled",!1),form.find(".cn-upload-file,.status").remove();var table=form.find("#cn-import-category-options table tbody");$.each(response.data.headers,(function(key,value){var input=html.string({tag:"input",attrs:{type:"text",class:"cn-field-name",value:value,readonly:"READONLY"},single:!0}),fields=$(html.string({tag:"select",attrs:{name:value}}));$.each(response.data.fields,(function(key,value){var option=html.string({tag:"option",content:value,attrs:{value:key}});fields.append(option)}));var row=html.string({tag:"tr",content:"<td>"+input+"</td><td>"+fields.prop("outerHTML")+"</td>",attrs:{class:"cn-repeatable-row"}});table.append(row)})),form.find("select").change((function(){form.find("select option").prop("disabled",!1);var arr=$.map(form.find("select option:selected"),(function(n){return n.value}));form.find("select option").filter((function(){var value=$(this).val();return-1!=value&&!$(this).prop("selected")&&$.inArray(value,arr)>-1})).prop("disabled",!0)})),form.find(".cn-import-options").slideDown(),submit.on("click",(function(e){e.preventDefault(),submit.addClass("button-disabled").prop("disabled",!0),form.find(".status").remove(),form.append('<div class="status"><div class="notice notice-warning"><p>The CSV file is being imported, please be patient. Do not leave or close this page until you receive the "Import Completed" message. Doing so would interrupt the import process.</p></div><span class="spinner is-active"></span><div class="import-progress"><div></div></div></div>');var values={};form.find("select").each((function(){values[this.name]=$(this).val()})),response.data.map=JSON.stringify(values),CN_CSV_Import.submit("import_csv_term",response.data,1,response.data.nonce,form,CN_CSV_Import)}))}else CN_CSV_Import.error(xhr)},error:function(xhr,textStatus){console.log("error"),console.log(xhr);var response=xhr.responseJSON,form=$("#"+response.data.form.id),status=form.find(".status"),submit=form.find('input[type="submit"]');form.find(".button-disabled").removeClass("button-disabled"),0==response.success?(submit.removeClass("button-disabled").prop("disabled",!1),status.html('<div class="notice notice-error"><p>'+response.data.message+"</p></div>")):status.remove()},submit:function(action,data,step,nonce,form,self){var wp;window.wp.ajax.send(action,{success:function(response){if(console.log(response),"completed"==response.step){var status=form.find(".status"),submit=form.find('input[type="submit"]');form.find(".cn-import-options").slideUp(),submit.removeClass("button-disabled").prop("disabled",!1),status.html('<div class="notice notice-success"><p>'+response.message+"</p></div>")}else{var progress;form.find(".import-progress div").animate({width:response.percentage+"%"},50,(function(){})),self.step(action,data,response.step,response.nonce,form,self)}},error:function(response){console.log(response);var status=form.find(".status"),submit=form.find('input[type="submit"]');form.find(".cn-import-options").slideUp(),status.html('<div class="notice notice-error"><p>'+response.message+"</p></div>")},data:{_ajax_nonce:nonce,step:step,file:data.file,map:data.map}})},step:function(action,data,step,nonce,form,self){self.submit(action,data,step,nonce,form,self)}};CN_CSV_Import.init()}));