jQuery(document).ready(function(a){var b={init:function(){var b=this;a(".cn-import-form").ajaxForm({beforeSubmit:b.beforeSubmit,success:b.success,complete:b.complete,dataType:"json",error:b.error})},beforeSubmit:function(a,b){var c=b.find('.cn-upload-file input[type="submit"]');return c.hasClass("button-disabled")?void 0:(c.addClass("button-disabled").prop("disabled",!0),b.find(".status").remove(),!0)},success:function(){},complete:function(c){var d=window.wp.html,e=jQuery.parseJSON(c.responseText);if(e.success){var f=a("#"+e.data.form.id),g=f.find('input[type="submit"]');g.removeClass("button-disabled").prop("disabled",!1),f.find(".cn-upload-file,.status").remove();var h=f.find("#cn-import-category-options table tbody");a.each(e.data.headers,function(b,c){var f=d.string({tag:"input",attrs:{type:"text","class":"cn-field-name",value:c,readonly:"READONLY"},single:!0}),g=a(d.string({tag:"select",attrs:{name:c}}));a.each(e.data.fields,function(a,b){var c=d.string({tag:"option",content:b,attrs:{value:a}});g.append(c)});var i=d.string({tag:"tr",content:"<td>"+f+"</td><td>"+g.prop("outerHTML")+"</td>",attrs:{"class":"cn-repeatable-row"}});h.append(i)}),f.find("select").change(function(){f.find("select option").prop("disabled",!1);var b=a.map(f.find("select option:selected"),function(a){return a.value});f.find("select option").filter(function(){var c=a(this).val();return-1==c||a(this).prop("selected")?!1:a.inArray(c,b)>-1}).prop("disabled",!0)}),f.find(".cn-import-options").slideDown(),g.on("click",function(c){c.preventDefault(),g.addClass("button-disabled").prop("disabled",!0),f.find(".status").remove(),f.append('<div class="status"><div class="notice notice-warning"><p>The CSV file is being imported, please be patient. Do not leave or close this page until you receive the "Import Completed" message. Doing so would interrupt the import process.</p></div><span class="spinner is-active"></span><div class="import-progress"><div></div></div></div>');var d={};f.find("select").each(function(){d[this.name]=a(this).val()}),e.data.map=JSON.stringify(d),b.submit("import_csv_term",e.data,1,e.data.nonce,f,b)})}else b.error(c)},error:function(b){console.log("error"),console.log(b);var c=b.responseJSON,d=a("#"+c.data.form.id),e=d.find(".status"),f=d.find('input[type="submit"]');d.find(".button-disabled").removeClass("button-disabled"),0==c.success?(f.removeClass("button-disabled").prop("disabled",!1),e.html('<div class="notice notice-error"><p>'+c.data.message+"</p></div>")):e.remove()},submit:function(a,b,c,d,e,f){var g=window.wp;g.ajax.send(a,{success:function(c){if(console.log(c),"completed"==c.step){var d=e.find(".status"),g=e.find('input[type="submit"]');e.find(".cn-import-options").slideUp(),g.removeClass("button-disabled").prop("disabled",!1),d.html('<div class="notice notice-success"><p>'+c.message+"</p></div>")}else{var h=e.find(".import-progress div");h.animate({width:c.percentage+"%"},50,function(){}),f.step(a,b,c.step,c.nonce,e,f)}},error:function(a){console.log(a);{var b=e.find(".status");e.find('input[type="submit"]')}e.find(".cn-import-options").slideUp(),b.html('<div class="notice notice-error"><p>'+a.message+"</p></div>")},data:{_ajax_nonce:d,step:c,file:b.file,map:b.map}})},step:function(a,b,c,d,e,f){f.submit(a,b,c,d,e,f)}};b.init()});