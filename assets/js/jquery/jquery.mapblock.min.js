jQuery(function(a){var c=[],l=0;a.fn.mapBlock=function(g){console.log("mapBlock found.");var d={};a.each(a(this).get(0).attributes,function(a,c){"data"===c.name.substr(0,4)&&(d[c.name]=c.value.replace(/_/g," "))});console.log(d);a.each(d,function(a,c){var b=a.replace("data-","").split("-");1===b.length&&(g[b[0]]=c)});console.log(g);var m=a(this).attr("id");console.log(m);a("#"+m).on("appear",{id:l,data:g},function(g,d){d.each(function(){var b=g.data.id,d=g.data.data,k=a(this).attr("id");console.log(k+
":isVisible");if("undefined"===typeof c[b]){c[b]=L.map(k).setView(L.latLng(d.center.split(",")),1);c[b].attributionControl.setPrefix("");a.each(a(this).children("map-tilelayer"),function(k,e){var f=a(e);switch(f.data("id")){case "google":f=L.gridLayer.googleMutant({attribution:f.html()});break;default:f=L.tileLayer(f.data("url"),{attribution:f.html(),subdomains:f.data("subdomains"),minZoom:f.data("minzoom"),maxZoom:f.data("maxzoom")})}f.addTo(c[b])});var e=[],h={},p=L.latLngBounds([]),r=0;a.each(a(this).children("map-layergroup"),
function(k,d){console.log(d);var f=a(d),g=f.data("id"),m=f.data("name");f=f.data("control");var l=[];a.each(a(this).children("map-marker"),function(f,c){console.log(c);var b=a(c),k=b.data("latitude"),e=b.data("longitude");b=b.find("map-marker-popup");0===b.length?l.push(L.marker([k,e])):l.push(L.marker([k,e]).bindPopup(b.html()));r++});e[g]=L.featureGroup(l).addTo(c[b]);p.extend(e[g].getBounds());f&&(h[m]=e[g])});a.each(a(this).children("map-marker"),function(k,e){var f=[];console.log(e);var h=a(e),
d=h.data("latitude"),g=h.data("longitude");h=h.find("map-marker-popup");0===h.length?f.push(L.marker([d,g])):f.push(L.marker([d,g]).bindPopup(h.html()));f=L.featureGroup(f).addTo(c[b]);p.extend(f.getBounds());r++});a.isEmptyObject(h)||L.control.layers({},h).addTo(c[b]);p.isValid()&&c[b].fitBounds(p,{padding:L.point(20,20)});1>=r&&c[b].setZoom(d.zoom);c[b].on("overlayadd overlayremove",function(a){console.log(a);var e=new L.LatLngBounds;c[b].eachLayer(function(a){a instanceof L.FeatureGroup&&e.extend(a.getBounds())});
e.isValid()?c[b].fitBounds(e):c[b].fitWorld()})}})});a.inView("#"+m);l++};a("map-block").each(function(){a(this).mapBlock({})});a.force_appear()});
(function(a){function c(b){return a(b).filter(function(){return a(this).is(":appeared")})}function l(){m=!1;for(var a=0,e=g.length;a<e;a++){var h=c(g[a]);h.length&&!0!==q[a]&&(h.trigger("appear",[h]),q[a]=!0);if(b[a]){var d=b[a].not(h);d.length&&(d.trigger("disappear",[d]),q[a]=!1)}b[a]=h}}var g=[],d=!1,m=!1,t={interval:250,force_process:!1},n=a(window),b=[],q=[];a.expr.pseudos.appeared=a.expr.createPseudo(function(b){return function(b){b=a(b);if(!b.is(":visible"))return!1;var c=n.scrollLeft(),d=
n.scrollTop(),e=b.offset(),g=e.left;e=e.top;return e+b.height()>=d&&e-(b.data("in-view-top-offset")||0)<=d+n.height()&&g+b.width()>=c&&g-(b.data("in-view-left-offset")||0)<=c+n.width()?!0:!1}});a.fn.extend({inView:function(b,c){a.inView(this,c);return this}});a.extend({inView:function(c,e){var h=a.extend({},t,e||{});if(!d){var k=function(){m||(m=!0,setTimeout(l,h.interval))};a(window).on("scroll",k).on("resize",k).on("click",k);d=!0}h.force_process&&setTimeout(l,h.interval);g.push(c);b.push()},force_appear:function(){return d?
(l(),!0):!1}})})(jQuery);