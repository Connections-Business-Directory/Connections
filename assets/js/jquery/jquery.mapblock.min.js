jQuery(function(a){var d=[],k=0;a.fn.mapBlock=function(g){console.log("mapBlock found.");var c={};a.each(a(this).get(0).attributes,function(a,d){"data"===d.name.substr(0,4)&&(c[d.name]=d.value.replace(/_/g," "))});console.log(c);a.each(c,function(a,d){var b=a.replace("data-","").split("-");1===b.length&&(g[b[0]]=d)});console.log(g);var m=a(this).attr("id");console.log(m);a("#"+m).on("appear",{id:k,data:g},function(g,c){c.each(function(){var b=g.data.id,c=g.data.data,n=a(this).attr("id");console.log(n+
":isVisible");if("undefined"===typeof d[b]){d[b]=L.map(n).setView(L.latLng(c.center.split(",")),c.zoom);d[b].attributionControl.setPrefix("");a.each(a(this).children("map-tilelayer"),function(n,e){var f=a(e);switch(f.data("id")){case "google":f=L.gridLayer.googleMutant({attribution:f.html()});break;default:f=L.tileLayer(f.data("url"),{attribution:f.html(),subdomains:f.data("subdomains"),minZoom:f.data("minzoom"),maxZoom:f.data("maxzoom")})}f.addTo(d[b])});var e=[],l={},h=L.latLngBounds([]),r=0;a.each(a(this).children("map-layergroup"),
function(n,c){console.log(c);var f=a(c),g=f.data("id"),m=f.data("name");f=f.data("control");var k=[];a.each(a(this).children("map-marker"),function(f,d){console.log(d);var b=a(d),n=b.data("latitude"),e=b.data("longitude");b=b.find("map-marker-popup");0===b.length?k.push(L.marker([n,e])):k.push(L.marker([n,e]).bindPopup(b.html()));r++});e[g]=L.featureGroup(k).addTo(d[b]);h.extend(e[g].getBounds());f&&(l[m]=e[g])});a.each(a(this).children("map-marker"),function(n,e){var f=[];console.log(e);var c=a(e),
l=c.data("latitude"),g=c.data("longitude");c=c.find("map-marker-popup");0===c.length?f.push(L.marker([l,g])):f.push(L.marker([l,g]).bindPopup(c.html()));f=L.featureGroup(f).addTo(d[b]);h.extend(f.getBounds());r++});a.isEmptyObject(l)||L.control.layers({},l).addTo(d[b]);h.isValid()&&d[b].fitBounds(h,{padding:L.point(20,20)});1===r&&d[b].setZoom(c.zoom);d[b].on("overlayadd overlayremove",function(a){console.log(a);var e=new L.LatLngBounds;d[b].eachLayer(function(a){a instanceof L.FeatureGroup&&e.extend(a.getBounds())});
e.isValid()?d[b].fitBounds(e):d[b].fitWorld()})}})});a.appear("#"+m);k++};a("map-block").each(function(){a(this).mapBlock({})});a.force_appear()});
(function(a){function d(b){return a(b).filter(function(){return a(this).is(":appeared")})}function k(){m=!1;for(var a=0,e=g.length;a<e;a++){var c=d(g[a]);c.length&&!0!==q[a]&&(c.trigger("appear",[c]),q[a]=!0);if(b[a]){var h=b[a].not(c);h.length&&(h.trigger("disappear",[h]),q[a]=!1)}b[a]=c}}var g=[],c=!1,m=!1,t={interval:250,force_process:!1},p=a(window),b=[],q=[];a.expr.pseudos.appeared=a.expr.createPseudo(function(b){return function(b){b=a(b);if(!b.is(":visible"))return!1;var c=p.scrollLeft(),d=
p.scrollTop(),e=b.offset(),g=e.left;e=e.top;return e+b.height()>=d&&e-(b.data("appear-top-offset")||0)<=d+p.height()&&g+b.width()>=c&&g-(b.data("appear-left-offset")||0)<=c+p.width()?!0:!1}});a.fn.extend({appear:function(b,c){a.appear(this,c);return this}});a.extend({appear:function(d,e){var l=a.extend({},t,e||{});if(!c){var h=function(){m||(m=!0,setTimeout(k,l.interval))};a(window).on("scroll",h).on("resize",h).on("click",h);c=!0}l.force_process&&setTimeout(k,l.interval);g.push(d);b.push()},force_appear:function(){return c?
(k(),!0):!1}})})(jQuery);