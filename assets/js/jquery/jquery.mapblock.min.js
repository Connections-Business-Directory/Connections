jQuery(function(a){var c=[],n=0;a.fn.mapBlock=function(l){console.log("mapBlock found.");var d={};a.each(a(this).get(0).attributes,function(a,c){"data"===c.name.substr(0,4)&&(d[c.name]=c.value.replace(/_/g," "))});console.log(d);a.each(d,function(a,c){var e=a.replace("data-","").split("-");1===e.length&&(l[e[0]]=c)});console.log(l);var k=a(this).attr("id");console.log(k);a("#"+k).on("appear",{id:n,data:l},function(l,d){d.each(function(){var e=l.data.id,d=l.data.data,h=a(this).attr("id");console.log(h+
":isVisible");if("undefined"===typeof c[e]){c[e]=L.map(h).setView(L.latLng(d.center.split(",")),1);c[e].attributionControl.setPrefix("");var b={};a.each(a(this).children("map-tilelayer"),function(h,g){var f=a(g);switch(!0){case /^google/.test(f.data("id")):var m=L.gridLayer.googleMutant({type:f.data("type"),attribution:f.html()});break;default:m=L.tileLayer(f.data("url"),{attribution:f.html(),subdomains:f.data("subdomains"),minZoom:f.data("minzoom"),maxZoom:f.data("maxzoom")})}a.isEmptyObject(b)&&
m.addTo(c[e]);f=a("map-control-layers").find('[data-id="'+f.data("id")+'"]');f.length&&(b[f.html()]=m)});var g=[],p={},r=L.latLngBounds([]),k=0;a.each(a(this).children("map-layergroup"),function(h,b){console.log(b);var f=a(b),m=f.data("id");f.data("name");var d=[];a.each(a(this).children("map-marker"),function(f,h){console.log(h);var b=a(h),c=b.data("latitude"),e=b.data("longitude");b=b.find("map-marker-popup");0===b.length?d.push(L.marker([c,e])):d.push(L.marker([c,e]).bindPopup(b.html()));k++});
g[m]=L.featureGroup(d).addTo(c[e]);r.extend(g[m].getBounds());f=a("map-control-layers").find('[data-id="'+m+'"]');f.length&&(p[f.html()]=g[m])});a.each(a(this).children("map-marker"),function(b,h){var f=[];console.log(h);var g=a(h),d=g.data("latitude"),p=g.data("longitude");g=g.find("map-marker-popup");0===g.length?f.push(L.marker([d,p])):f.push(L.marker([d,p]).bindPopup(g.html()));f=L.featureGroup(f).addTo(c[e]);r.extend(f.getBounds());k++});a.isEmptyObject(b)&&a.isEmptyObject(p)||(h=a(this).find("map-control-layers"),
L.control.layers(b,p,{collapsed:h.data("collapsed"),hideSingleBase:!0}).addTo(c[e]));r.isValid()&&c[e].fitBounds(r,{padding:L.point(20,20)});1>=k&&c[e].setZoom(d.zoom);c[e].on("overlayadd overlayremove",function(a){console.log(a);var b=new L.LatLngBounds;c[e].eachLayer(function(a){a instanceof L.FeatureGroup&&b.extend(a.getBounds())});b.isValid()?c[e].fitBounds(b):c[e].fitWorld()})}})});a.inView("#"+k);n++};a("map-block").each(function(){a(this).mapBlock({})});a.force_appear()});
(function(a){function c(h){return a(h).filter(function(){return a(this).is(":appeared")})}function n(){k=!1;for(var a=0,b=l.length;a<b;a++){var g=c(l[a]);g.length&&!0!==t[a]&&(g.trigger("appear",[g]),t[a]=!0);if(e[a]){var d=e[a].not(g);d.length&&(d.trigger("disappear",[d]),t[a]=!1)}e[a]=g}}var l=[],d=!1,k=!1,u={interval:250,force_process:!1},q=a(window),e=[],t=[];a.expr.pseudos.appeared=a.expr.createPseudo(function(c){return function(b){b=a(b);if(!b.is(":visible"))return!1;var c=q.scrollLeft(),e=
q.scrollTop(),d=b.offset(),h=d.left;d=d.top;return d+b.height()>=e&&d-(b.data("in-view-top-offset")||0)<=e+q.height()&&h+b.width()>=c&&h-(b.data("in-view-left-offset")||0)<=c+q.width()?!0:!1}});a.fn.extend({inView:function(d,b){a.inView(this,b);return this}});a.extend({inView:function(c,b){var g=a.extend({},u,b||{});if(!d){var h=function(){k||(k=!0,setTimeout(n,g.interval))};a(window).on("scroll",h).on("resize",h).on("click",h);d=!0}g.force_process&&setTimeout(n,g.interval);l.push(c);e.push()},force_appear:function(){return d?
(n(),!0):!1}})})(jQuery);