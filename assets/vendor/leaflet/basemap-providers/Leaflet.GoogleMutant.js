!function(){"use strict";var t=Symbol("newer"),e=Symbol("older"),i=function(t,e){"number"!=typeof t&&(e=t,t=0),this.size=0,this.limit=t,this.oldest=this.newest=void 0,this._keymap=new Map,e&&(this.assign(e),t<1&&(this.limit=this.size))};function o(i,o){this.key=i,this.value=o,this[t]=void 0,this[e]=void 0}function n(t){this.entry=t}function s(t){this.entry=t}function a(t){this.entry=t}i.prototype._markEntryAsUsed=function(i){i!==this.newest&&(i[t]&&(i===this.oldest&&(this.oldest=i[t]),i[t][e]=i[e]),i[e]&&(i[e][t]=i[t]),i[t]=void 0,i[e]=this.newest,this.newest&&(this.newest[t]=i),this.newest=i)},i.prototype.assign=function(i){var n,s=this.limit||Number.MAX_VALUE;this._keymap.clear();for(var a=i[Symbol.iterator](),r=a.next();!r.done;r=a.next()){var l=new o(r.value[0],r.value[1]);if(this._keymap.set(l.key,l),n?(n[t]=l,l[e]=n):this.oldest=l,n=l,0==s--)throw new Error("overflow")}this.newest=n,this.size=this._keymap.size},i.prototype.get=function(t){var e=this._keymap.get(t);if(e)return this._markEntryAsUsed(e),e.value},i.prototype.set=function(i,n){var s=this._keymap.get(i);return s?(s.value=n,this._markEntryAsUsed(s),this):(this._keymap.set(i,s=new o(i,n)),this.newest?(this.newest[t]=s,s[e]=this.newest):this.oldest=s,this.newest=s,++this.size,this.size>this.limit&&this.shift(),this)},i.prototype.shift=function(){var i=this.oldest;if(i)return this.oldest[t]?(this.oldest=this.oldest[t],this.oldest[e]=void 0):(this.oldest=void 0,this.newest=void 0),i[t]=i[e]=void 0,this._keymap.delete(i.key),--this.size,[i.key,i.value]},i.prototype.find=function(t){var e=this._keymap.get(t);return e?e.value:void 0},i.prototype.has=function(t){return this._keymap.has(t)},i.prototype.delete=function(i){var o=this._keymap.get(i);if(o)return this._keymap.delete(o.key),o[t]&&o[e]?(o[e][t]=o[t],o[t][e]=o[e]):o[t]?(o[t][e]=void 0,this.oldest=o[t]):o[e]?(o[e][t]=void 0,this.newest=o[e]):this.oldest=this.newest=void 0,this.size--,o.value},i.prototype.clear=function(){this.oldest=this.newest=void 0,this.size=0,this._keymap.clear()},i.prototype.keys=function(){return new s(this.oldest)},i.prototype.values=function(){return new a(this.oldest)},i.prototype.entries=function(){return this},i.prototype[Symbol.iterator]=function(){return new n(this.oldest)},i.prototype.forEach=function(e,i){"object"!=typeof i&&(i=this);for(var o=this.oldest;o;)e.call(i,o.value,o.key,this),o=o[t]},i.prototype.toJSON=function(){for(var e=new Array(this.size),i=0,o=this.oldest;o;)e[i++]={key:o.key,value:o.value},o=o[t];return e},i.prototype.toString=function(){for(var e="",i=this.oldest;i;)e+=String(i.key)+":"+i.value,(i=i[t])&&(e+=" < ");return e},n.prototype[Symbol.iterator]=function(){return this},n.prototype.next=function(){var e=this.entry;return e?(this.entry=e[t],{done:!1,value:[e.key,e.value]}):{done:!0,value:void 0}},s.prototype[Symbol.iterator]=function(){return this},s.prototype.next=function(){var e=this.entry;return e?(this.entry=e[t],{done:!1,value:e.key}):{done:!0,value:void 0}},a.prototype[Symbol.iterator]=function(){return this},a.prototype.next=function(){var e=this.entry;return e?(this.entry=e[t],{done:!1,value:e.value}):{done:!0,value:void 0}},L.GridLayer.GoogleMutant=L.GridLayer.extend({options:{maxZoom:21,type:"roadmap",maxNativeZoom:21},initialize:function(t){L.GridLayer.prototype.initialize.call(this,t),this._tileCallbacks={},this._lru=new i(100),this._imagesPerTile="hybrid"===this.options.type?2:1,this._boundOnMutatedImage=this._onMutatedImage.bind(this)},onAdd:function(t){var e,i,o,n,s=this;L.GridLayer.prototype.onAdd.call(this,t),this._initMutantContainer(),this._logoContainer&&t._controlCorners.bottomleft.appendChild(this._logoContainer),this._attributionContainer&&t._controlCorners.bottomright.appendChild(this._attributionContainer),e=function(){s._map&&(s._initMutant(),google.maps.event.addListenerOnce(s._mutant,"idle",(function(){s._map&&(s._checkZoomLevels(),s._mutantIsReady=!0)})))},o=0,n=null,n=setInterval((function(){if(o>=20)throw clearInterval(n),new Error("window.google not found after 10 seconds");window.google&&window.google.maps&&window.google.maps.Map&&(clearInterval(n),e.call(i)),++o}),500)},onRemove:function(t){L.GridLayer.prototype.onRemove.call(this,t),this._observer.disconnect(),t._container.removeChild(this._mutantContainer),this._logoContainer&&L.DomUtil.remove(this._logoContainer),this._attributionContainer&&L.DomUtil.remove(this._attributionContainer),this._mutant&&google.maps.event.clearListeners(this._mutant,"idle")},addGoogleLayer:function(t,e){var i=this;return this._subLayers||(this._subLayers={}),this.whenReady((function(){var o=new(0,google.maps[t])(e);o.setMap(i._mutant),i._subLayers[t]=o})),this},removeGoogleLayer:function(t){var e=this;return this.whenReady((function(){var i=e._subLayers&&e._subLayers[t];i&&(i.setMap(null),delete e._subLayers[t])})),this},_initMutantContainer:function(){this._mutantContainer||(this._mutantContainer=L.DomUtil.create("div","leaflet-google-mutant leaflet-top leaflet-left"),this._mutantContainer.id="_MutantContainer_"+L.Util.stamp(this._mutantContainer),this._mutantContainer.style.pointerEvents="none",this._mutantContainer.style.visibility="hidden",L.DomEvent.off(this._mutantContainer)),this._map.getContainer().appendChild(this._mutantContainer),this.setOpacity(this.options.opacity);var t=this._mutantContainer.style;this._map.options.zoomSnap<1?(t.width="180%",t.height="180%"):(t.width="100%",t.height="100%"),t.zIndex=-1,this._attachObserver(this._mutantContainer)},_initMutant:function(){if(!this._mutant){var t=new google.maps.Map(this._mutantContainer,{center:{lat:0,lng:0},zoom:0,tilt:0,mapTypeId:this.options.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,styles:this.options.styles||[],backgroundColor:"transparent"});this._mutant=t,this._update(),this.fire("spawned",{mapObject:t}),this._waitControls(),this.once("controls_ready",this._setupAttribution)}},_attachObserver:function(t){this._observer||(this._observer=new MutationObserver(this._onMutations.bind(this))),this._observer.observe(t,{childList:!0,subtree:!0}),Array.prototype.forEach.call(t.querySelectorAll("img"),this._boundOnMutatedImage)},_waitControls:function(){var t=this,e=setInterval((function(){var i,o=t._mutant.__gm.layoutManager;o&&(clearInterval(e),Object.keys(o).forEach((function(t){var e=o[t];e.get&&e.get(1)instanceof Node&&(i=e)})),t.fire("controls_ready",{positions:i}))}),50)},_setupAttribution:function(t){var e=google.maps.ControlPosition,i=this._attributionContainer=t.positions.get(e.BOTTOM_RIGHT);L.DomUtil.addClass(i,"leaflet-control leaflet-control-attribution"),L.DomEvent.disableClickPropagation(i),i.style.height="14px",this._map._controlCorners.bottomright.appendChild(i),this._logoContainer=t.positions.get(e.BOTTOM_LEFT),this._logoContainer.style.pointerEvents="auto",this._map._controlCorners.bottomleft.appendChild(this._logoContainer)},_onMutations:function(t){for(var e=0;e<t.length;++e)for(var i=t[e],o=0;o<i.addedNodes.length;++o){var n=i.addedNodes[o];n instanceof HTMLImageElement?this._onMutatedImage(n):n instanceof HTMLElement&&Array.prototype.forEach.call(n.querySelectorAll("img"),this._boundOnMutatedImage)}},_roadRegexp:/!1i(\d+)!2i(\d+)!3i(\d+)!/,_satRegexp:/x=(\d+)&y=(\d+)&z=(\d+)/,_staticRegExp:/StaticMapService\.GetMapImage/,_onMutatedImage:function(t){var e,i=t.src.match(this._roadRegexp),o=0;if(i?(e={z:i[1],x:i[2],y:i[3]},this._imagesPerTile>1&&(t.style.zIndex=1,o=1)):((i=t.src.match(this._satRegexp))&&(e={x:i[1],y:i[2],z:i[3]}),o=0),e){var n=this._tileCoordsToKey(e);t.style.position="absolute";var s=n+"/"+o;this._lru.set(s,t),s in this._tileCallbacks&&this._tileCallbacks[s]&&(this._tileCallbacks[s].forEach((function(e){return e(t)})),delete this._tileCallbacks[s])}},createTile:function(t,e){var i=this._tileCoordsToKey(t),o=L.DomUtil.create("div");o.style.textAlign="left",o.dataset.pending=this._imagesPerTile,e=e.bind(this,null,o);for(var n=0;n<this._imagesPerTile;++n){var s=i+"/"+n,a=this._lru.get(s);a?(o.appendChild(this._clone(a)),--o.dataset.pending):(this._tileCallbacks[s]=this._tileCallbacks[s]||[],this._tileCallbacks[s].push(function(t){return function(i){t.appendChild(this._clone(i)),--t.dataset.pending,parseInt(t.dataset.pending)||e()}.bind(this)}.bind(this)(o)))}return parseInt(o.dataset.pending)||L.Util.requestAnimFrame(e),o},_clone:function(t){var e=t.cloneNode(!0);return e.style.visibility="visible",e},_checkZoomLevels:function(){var t=this._map.getZoom(),e=this._mutant.getZoom();t&&e&&(e!==t||e>this.options.maxNativeZoom)&&this._setMaxNativeZoom(e)},_setMaxNativeZoom:function(t){t!==this.options.maxNativeZoom&&(this.options.maxNativeZoom=t,this._resetView())},_update:function(t){if(this._mutant){t=t||this._map.getCenter();var e=new google.maps.LatLng(t.lat,t.lng),i=Math.round(this._map.getZoom()),o=this._mutant.getZoom();this._mutant.setCenter(e),i!==o&&(this._mutant.setZoom(i),this._mutantIsReady&&this._checkZoomLevels())}L.GridLayer.prototype._update.call(this,t)},whenReady:function(t,e){return this._mutant?t.call(e||this,{target:this}):this.on("spawned",t,e),this}}),L.gridLayer.googleMutant=function(t){return new L.GridLayer.GoogleMutant(t)}}();