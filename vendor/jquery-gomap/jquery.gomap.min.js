(function(b){var c=new google.maps.Geocoder();function a(d){this.setMap(d);}a.prototype=new google.maps.OverlayView();a.prototype.onAdd=function(){};a.prototype.onRemove=function(){};
a.prototype.draw=function(){};b.goMap={};b.fn.goMap=function(d){return this.each(function(){var e=b(this).data("goMap");if(!e){var f=b.extend(true,{},b.goMapBase);
b(this).data("goMap",f.init(this,d));b.goMap=f;}else{b.goMap=e;}});};b.goMapBase={defaults:{address:"",latitude:56.9,longitude:24.1,zoom:4,delay:200,hideByClick:true,oneInfoWindow:true,prefixId:"gomarker",polyId:"gopoly",groupId:"gogroup",navigationControl:true,navigationControlOptions:{position:"TOP_LEFT",style:"DEFAULT"},mapTypeControl:true,mapTypeControlOptions:{position:"TOP_RIGHT",style:"DEFAULT"},scaleControl:false,scrollwheel:true,directions:false,directionsResult:null,disableDoubleClickZoom:false,streetViewControl:false,markers:[],overlays:[],polyline:{color:"#FF0000",opacity:1,weight:2},polygon:{color:"#FF0000",opacity:1,weight:2,fillColor:"#FF0000",fillOpacity:0.2},circle:{color:"#FF0000",opacity:1,weight:2,fillColor:"#FF0000",fillOpacity:0.2},rectangle:{color:"#FF0000",opacity:1,weight:2,fillColor:"#FF0000",fillOpacity:0.2},maptype:"HYBRID",html_prepend:'<div class="gomapMarker">',html_append:"</div>",addMarker:false},map:null,count:0,markers:[],polylines:[],polygons:[],circles:[],rectangles:[],tmpMarkers:[],geoMarkers:[],lockGeocode:false,bounds:null,overlays:null,overlay:null,mapId:null,plId:null,pgId:null,cId:null,rId:null,opts:null,centerLatLng:null,init:function(i,h){var k=b.extend(true,{},b.goMapBase.defaults,h);
this.mapId=b(i);this.opts=k;if(k.address){this.geocode({address:k.address,center:true});}else{if(b.isArray(k.markers)&&k.markers.length>0){if(k.markers[0].address){this.geocode({address:k.markers[0].address,center:true});
}else{this.centerLatLng=new google.maps.LatLng(k.markers[0].latitude,k.markers[0].longitude);}}else{this.centerLatLng=new google.maps.LatLng(k.latitude,k.longitude);
}}var e={center:this.centerLatLng,disableDoubleClickZoom:k.disableDoubleClickZoom,mapTypeControl:k.mapTypeControl,streetViewControl:k.streetViewControl,mapTypeControlOptions:{position:google.maps.ControlPosition[k.mapTypeControlOptions.position.toUpperCase()],style:google.maps.MapTypeControlStyle[k.mapTypeControlOptions.style.toUpperCase()]},mapTypeId:google.maps.MapTypeId[k.maptype.toUpperCase()],panControl:k.navigationControl,zoomControl:k.navigationControl,panControlOptions:{position:google.maps.ControlPosition[k.navigationControlOptions.position.toUpperCase()]},zoomControlOptions:{position:google.maps.ControlPosition[k.navigationControlOptions.position.toUpperCase()],style:google.maps.ZoomControlStyle[k.navigationControlOptions.style.toUpperCase()]},scaleControl:k.scaleControl,scrollwheel:k.scrollwheel,zoom:k.zoom};
this.map=new google.maps.Map(i,e);this.overlay=new a(this.map);this.overlays={polyline:{id:"plId",array:"polylines",create:"createPolyline"},polygon:{id:"pgId",array:"polygons",create:"createPolygon"},circle:{id:"cId",array:"circles",create:"createCircle"},rectangle:{id:"rId",array:"rectangles",create:"createRectangle"}};
this.plId=b('<div style="display:none;"/>').appendTo(this.mapId);this.pgId=b('<div style="display:none;"/>').appendTo(this.mapId);this.cId=b('<div style="display:none;"/>').appendTo(this.mapId);
this.rId=b('<div style="display:none;"/>').appendTo(this.mapId);for(var g=0,d=k.markers.length;g<d;g++){this.createMarker(k.markers[g]);}for(var g=0,d=k.overlays.length;
g<d;g++){this[this.overlays[k.overlays[g].type].create](k.overlays[g]);}var f=this;if(k.addMarker==true||k.addMarker=="multi"){google.maps.event.addListener(f.map,"click",function(m){var l={position:m.latLng,draggable:true};
var j=f.createMarker(l);google.maps.event.addListener(j,"dblclick",function(n){j.setMap(null);f.removeMarker(j.id);});});}else{if(k.addMarker=="single"){google.maps.event.addListener(f.map,"click",function(m){if(!f.singleMarker){var l={position:m.latLng,draggable:true};
var j=f.createMarker(l);f.singleMarker=true;google.maps.event.addListener(j,"dblclick",function(n){j.setMap(null);f.removeMarker(j.id);f.singleMarker=false;
});}});}}delete k.markers;delete k.overlays;return this;},ready:function(d){google.maps.event.addListenerOnce(this.map,"bounds_changed",function(){return d();
});},geocode:function(d,f){var e=this;setTimeout(function(){c.geocode({address:d.address},function(h,g){if(g==google.maps.GeocoderStatus.OK&&d.center){e.map.setCenter(h[0].geometry.location);
}if(g==google.maps.GeocoderStatus.OK&&f&&f.markerId){f.markerId.setPosition(h[0].geometry.location);}else{if(g==google.maps.GeocoderStatus.OK&&f){if(e.lockGeocode){e.lockGeocode=false;
f.position=h[0].geometry.location;f.geocode=true;e.createMarker(f);}}else{if(g==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){e.geocode(d,f);}}}});},this.opts.delay);
},geoMarker:function(){if(this.geoMarkers.length>0&&!this.lockGeocode){this.lockGeocode=true;var e=this.geoMarkers.splice(0,1);this.geocode({address:e[0].address},e[0]);
}else{if(this.lockGeocode){var d=this;setTimeout(function(){d.geoMarker();},this.opts.delay);}}},setMap:function(d){delete d.mapTypeId;if(d.address){this.geocode({address:d.address,center:true});
delete d.address;}else{if(d.latitude&&d.longitude){d.center=new google.maps.LatLng(d.latitude,d.longitude);delete d.longitude;delete d.latitude;}}if(d.mapTypeControlOptions&&d.mapTypeControlOptions.position){d.mapTypeControlOptions.position=google.maps.ControlPosition[d.mapTypeControlOptions.position.toUpperCase()];
}if(d.mapTypeControlOptions&&d.mapTypeControlOptions.style){d.mapTypeControlOptions.style=google.maps.MapTypeControlStyle[d.mapTypeControlOptions.style.toUpperCase()];
}if(typeof d.navigationControl!=="undefined"){d.panControl=d.navigationControl;d.zoomControl=d.navigationControl;}if(d.navigationControlOptions&&d.navigationControlOptions.position){d.panControlOptions={position:google.maps.ControlPosition[d.navigationControlOptions.position.toUpperCase()]};
d.zoomControlOptions={position:google.maps.ControlPosition[d.navigationControlOptions.position.toUpperCase()]};}if(d.navigationControlOptions&&d.navigationControlOptions.style){if(typeof d.zoomControlOptions==="undefined"){d.zoomControlOptions={style:google.maps.ZoomControlStyle[d.navigationControlOptions.style.toUpperCase()]};
}else{d.zoomControlOptions.style=google.maps.ZoomControlStyle[d.navigationControlOptions.style.toUpperCase()];}}this.map.setOptions(d);},getMap:function(){return this.map;
},createListener:function(e,f,g){var h;if(typeof e!="object"){e={type:e};}if(e.type=="map"){h=this.map;}else{if(e.type=="marker"&&e.marker){h=b(this.mapId).data(e.marker);
}else{if(e.type=="info"&&e.marker){h=b(this.mapId).data(e.marker+"info");}}}if(h){return google.maps.event.addListener(h,f,g);}else{if((e.type=="marker"||e.type=="info")&&this.getMarkerCount()!=this.getTmpMarkerCount()){var d=this;
}}setTimeout(function(){d.createListener(e,f,g);},this.opts.delay);},removeListener:function(d){google.maps.event.removeListener(d);},setInfoWindow:function(d,f){var e=this;
f.content=e.opts.html_prepend+f.content+e.opts.html_append;var g=new google.maps.InfoWindow(f);g.show=false;b(e.mapId).data(d.id+"info",g);if(f.popup){e.openWindow(g,d,f);
g.show=true;}google.maps.event.addListener(d,"click",function(){if(g.show&&e.opts.hideByClick){g.close();g.show=false;}else{e.openWindow(g,d,f);g.show=true;
}});},openWindow:function(g,d,f){var e=this;if(this.opts.oneInfoWindow){this.clearInfo();}if(f.ajax){g.open(this.map,d);b.ajax({url:f.ajax,success:function(h){g.setContent(e.opts.html_prepend+h+e.opts.html_append);
}});}else{if(f.id){g.setContent(e.opts.html_prepend+b(f.id).html()+e.opts.html_append);g.open(this.map,d);}else{g.open(this.map,d);}}},setInfo:function(f,e){var d=b(this.mapId).data(f+"info");
if(typeof e=="object"){d.setOptions(goMap.opts.html_prepend+e+goMap.opts.html_append);}else{d.setContent(goMap.opts.html_prepend+e+goMap.opts.html_append);
}},getInfo:function(f,e){var d=b(this.mapId).data(f+"info").getContent();if(e){return b(d).html();}else{return d;}},clearInfo:function(){for(var e=0,d=this.markers.length;
e<d;e++){var f=b(this.mapId).data(this.markers[e]+"info");if(f){f.close();f.show=false;}}},fitBounds:function(g,h){var e=this;if(this.getMarkerCount()!=this.getTmpMarkerCount()){setTimeout(function(){e.fitBounds(g,h);
},this.opts.delay);}else{this.bounds=new google.maps.LatLngBounds();if(!g||(g&&g=="all")){for(var f=0,d=this.markers.length;f<d;f++){this.bounds.extend(b(this.mapId).data(this.markers[f]).position);
}}else{if(g&&g=="visible"){for(var f=0,d=this.markers.length;f<d;f++){if(this.getVisibleMarker(this.markers[f])){this.bounds.extend(b(this.mapId).data(this.markers[f]).position);
}}}else{if(g&&g=="markers"&&b.isArray(h)){for(var f=0,d=h.length;f<d;f++){this.bounds.extend(b(this.mapId).data(h[f]).position);}}}}this.map.fitBounds(this.bounds);
}},getBounds:function(){return this.map.getBounds();},createPolyline:function(d){d.type="polyline";return this.createOverlay(d);},createPolygon:function(d){d.type="polygon";
return this.createOverlay(d);},createCircle:function(d){d.type="circle";return this.createOverlay(d);},createRectangle:function(d){d.type="rectangle";return this.createOverlay(d);
},createOverlay:function(g){var f=[];if(!g.id){this.count++;g.id=this.opts.polyId+this.count;}switch(g.type){case"polyline":if(g.coords.length>0){for(var e=0,d=g.coords.length;
e<d;e++){f.push(new google.maps.LatLng(g.coords[e].latitude,g.coords[e].longitude));}f=new google.maps.Polyline({map:this.map,path:f,strokeColor:g.color?g.color:this.opts.polyline.color,strokeOpacity:g.opacity?g.opacity:this.opts.polyline.opacity,strokeWeight:g.weight?g.weight:this.opts.polyline.weight});
}else{return false;}break;case"polygon":if(g.coords.length>0){for(var e=0,d=g.coords.length;e<d;e++){f.push(new google.maps.LatLng(g.coords[e].latitude,g.coords[e].longitude));
}f=new google.maps.Polygon({map:this.map,path:f,strokeColor:g.color?g.color:this.opts.polygon.color,strokeOpacity:g.opacity?g.opacity:this.opts.polygon.opacity,strokeWeight:g.weight?g.weight:this.opts.polygon.weight,fillColor:g.fillColor?g.fillColor:this.opts.polygon.fillColor,fillOpacity:g.fillOpacity?g.fillOpacity:this.opts.polygon.fillOpacity});
}else{return false;}break;case"circle":f=new google.maps.Circle({map:this.map,center:new google.maps.LatLng(g.latitude,g.longitude),radius:g.radius,strokeColor:g.color?g.color:this.opts.circle.color,strokeOpacity:g.opacity?g.opacity:this.opts.circle.opacity,strokeWeight:g.weight?g.weight:this.opts.circle.weight,fillColor:g.fillColor?g.fillColor:this.opts.circle.fillColor,fillOpacity:g.fillOpacity?g.fillOpacity:this.opts.circle.fillOpacity});
break;case"rectangle":f=new google.maps.Rectangle({map:this.map,bounds:new google.maps.LatLngBounds(new google.maps.LatLng(g.sw.latitude,g.sw.longitude),new google.maps.LatLng(g.ne.latitude,g.ne.longitude)),strokeColor:g.color?g.color:this.opts.circle.color,strokeOpacity:g.opacity?g.opacity:this.opts.circle.opacity,strokeWeight:g.weight?g.weight:this.opts.circle.weight,fillColor:g.fillColor?g.fillColor:this.opts.circle.fillColor,fillOpacity:g.fillOpacity?g.fillOpacity:this.opts.circle.fillOpacity});
break;default:return false;break;}this.addOverlay(g,f);return f;},addOverlay:function(e,d){b(this[this.overlays[e.type].id]).data(e.id,d);this[this.overlays[e.type].array].push(e.id);
},setOverlay:function(h,g,f){g=b(this[this.overlays[h].id]).data(g);if(f.coords&&f.coords.length>0){var i=[];for(var e=0,d=f.coords.length;e<d;e++){i.push(new google.maps.LatLng(f.coords[e].latitude,f.coords[e].longitude));
}f.path=i;delete f.coords;}else{if(f.ne&&f.sw){f.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(f.sw.latitude,f.sw.longitude),new google.maps.LatLng(f.ne.latitude,f.ne.longitude));
delete f.ne;delete f.sw;}else{if(f.latitude&&f.longitude){f.center=new google.maps.LatLng(f.latitude,f.longitude);delete f.latitude;delete f.longitude;
}}}g.setOptions(f);},showHideOverlay:function(e,d,f){if(typeof f==="undefined"){if(this.getVisibleOverlay(e,d)){f=false;}else{f=true;}}if(f){b(this[this.overlays[e].id]).data(d).setMap(this.map);
}else{b(this[this.overlays[e].id]).data(d).setMap(null);}},getVisibleOverlay:function(e,d){if(b(this[this.overlays[e].id]).data(d).getMap()){return true;
}else{return false;}},getOverlaysCount:function(d){return this[this.overlays[d].array].length;},removeOverlay:function(f,e){var d=b.inArray(e,this[this.overlays[f].array]),h;
if(d>-1){h=this[this.overlays[f].array].splice(d,1);var g=h[0];b(this[this.overlays[f].id]).data(g).setMap(null);b(this[this.overlays[f].id]).removeData(g);
return true;}return false;},clearOverlays:function(f){for(var e=0,d=this[this.overlays[f].array].length;e<d;e++){var g=this[this.overlays[f].array][e];
b(this[this.overlays[f].id]).data(g).setMap(null);b(this[this.overlays[f].id]).removeData(g);}this[this.overlays[f].array]=[];},showHideMarker:function(d,f){if(typeof f==="undefined"){if(this.getVisibleMarker(d)){b(this.mapId).data(d).setVisible(false);
var e=b(this.mapId).data(d+"info");if(e&&e.show){e.close();e.show=false;}}else{b(this.mapId).data(d).setVisible(true);}}else{b(this.mapId).data(d).setVisible(f);
}},showHideMarkerByGroup:function(k,j){for(var f=0,e=this.markers.length;f<e;f++){var g=this.markers[f];var d=b(this.mapId).data(g);if(d.group==k){if(typeof j==="undefined"){if(this.getVisibleMarker(g)){d.setVisible(false);
var h=b(this.mapId).data(g+"info");if(h&&h.show){h.close();h.show=false;}}else{d.setVisible(true);}}else{d.setVisible(j);}}}},getVisibleMarker:function(d){return b(this.mapId).data(d).getVisible();
},getMarkerCount:function(){return this.markers.length;},getTmpMarkerCount:function(){return this.tmpMarkers.length;},getVisibleMarkerCount:function(){return this.getMarkers("visiblesInMap").length;
},getMarkerByGroupCount:function(d){return this.getMarkers("group",d).length;},getMarkers:function(h,f){var j=[];switch(h){case"json":for(var g=0,d=this.markers.length;
g<d;g++){var e="'"+g+"': '"+b(this.mapId).data(this.markers[g]).getPosition().toUrlValue()+"'";j.push(e);}j="{'markers':{"+j.join(",")+"}}";break;case"data":for(var g=0,d=this.markers.length;
g<d;g++){var e="marker["+g+"]="+b(this.mapId).data(this.markers[g]).getPosition().toUrlValue();j.push(e);}j=j.join("&");break;case"visiblesInBounds":for(var g=0,d=this.markers.length;
g<d;g++){if(this.isVisible(b(this.mapId).data(this.markers[g]).getPosition())){j.push(this.markers[g]);}}break;case"visiblesInMap":for(var g=0,d=this.markers.length;
g<d;g++){if(this.getVisibleMarker(this.markers[g])){j.push(this.markers[g]);}}break;case"group":if(f){for(var g=0,d=this.markers.length;g<d;g++){if(b(this.mapId).data(this.markers[g]).group==f){j.push(this.markers[g]);
}}}break;case"markers":for(var g=0,d=this.markers.length;g<d;g++){var e=b(this.mapId).data(this.markers[g]);j.push(e);}break;default:for(var g=0,d=this.markers.length;
g<d;g++){var e=b(this.mapId).data(this.markers[g]).getPosition().toUrlValue();j.push(e);}break;}return j;},getVisibleMarkers:function(){return this.getMarkers("visiblesInBounds");
},createMarker:function(d){if(!d.geocode){this.count++;if(!d.id){d.id=this.opts.prefixId+this.count;}this.tmpMarkers.push(d.id);}if(d.address&&!d.geocode){this.geoMarkers.push(d);
this.geoMarker();}else{if(d.latitude&&d.longitude||d.position){var e={map:this.map};e.id=d.id;e.group=d.group?d.group:this.opts.groupId;e.zIndex=d.zIndex?d.zIndex:0;
e.zIndexOrg=d.zIndexOrg?d.zIndexOrg:0;if(d.visible==false){e.visible=d.visible;}if(d.title){e.title=d.title;}if(d.draggable){e.draggable=d.draggable;}if(d.icon&&d.icon.image){e.icon=d.icon.image;
if(d.icon.shadow){e.shadow=d.icon.shadow;}}else{if(d.icon){e.icon=d.icon;}else{if(this.opts.icon&&this.opts.icon.image){e.icon=this.opts.icon.image;if(this.opts.icon.shadow){e.shadow=this.opts.icon.shadow;
}}else{if(this.opts.icon){e.icon=this.opts.icon;}}}}e.position=d.position?d.position:new google.maps.LatLng(d.latitude,d.longitude);var f=new google.maps.Marker(e);
if(d.html){if(!d.html.content&&!d.html.ajax&&!d.html.id){d.html={content:d.html};}else{if(!d.html.content){d.html.content=null;}}this.setInfoWindow(f,d.html);
}this.addMarker(f);return f;}}},addMarker:function(d){b(this.mapId).data(d.id,d);this.markers.push(d.id);},setMarker:function(d,f){var g=b(this.mapId).data(d);
delete f.id;delete f.visible;if(f.icon){var e=f.icon;delete f.icon;if(e&&e=="default"){if(this.opts.icon&&this.opts.icon.image){f.icon=this.opts.icon.image;
if(this.opts.icon.shadow){f.shadow=this.opts.icon.shadow;}}else{if(this.opts.icon){f.icon=this.opts.icon;}}}else{if(e&&e.image){f.icon=e.image;if(e.shadow){f.shadow=e.shadow;
}}else{if(e){f.icon=e;}}}}if(f.address){this.geocode({address:f.address},{markerId:g});delete f.address;delete f.latitude;delete f.longitude;delete f.position;
}else{if(f.latitude&&f.longitude||f.position){if(!f.position){f.position=new google.maps.LatLng(f.latitude,f.longitude);}}}g.setOptions(f);},removeMarker:function(d){var e=b.inArray(d,this.markers),h;
if(e>-1){this.tmpMarkers.splice(e,1);h=this.markers.splice(e,1);var f=h[0];var d=b(this.mapId).data(f);var g=b(this.mapId).data(f+"info");d.setVisible(false);
d.setMap(null);b(this.mapId).removeData(f);if(g){g.close();g.show=false;b(this.mapId).removeData(f+"info");}return true;}return false;},clearMarkers:function(){for(var f=0,e=this.markers.length;
f<e;f++){var g=this.markers[f];var d=b(this.mapId).data(g);var h=b(this.mapId).data(g+"info");d.setVisible(false);d.setMap(null);b(this.mapId).removeData(g);
if(h){h.close();h.show=false;b(this.mapId).removeData(g+"info");}}this.singleMarker=false;this.lockGeocode=false;this.markers=[];this.tmpMarkers=[];this.geoMarkers=[];
},isVisible:function(d){return this.map.getBounds().contains(d);}};})(jQuery);