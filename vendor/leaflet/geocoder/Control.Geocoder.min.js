this.L=this.L||{};this.L.Control=this.L.Control||{};
this.L.Control.Geocoder=function(b){function r(a){return t[a]}function u(a){if(null==a)return"";if(!a)return a+"";a=""+a;return v.test(a)?a.replace(w,r):a}function p(a,c,e,d,f){var l="_l_geocoder_"+x++;c[f||"callback"]=l;window[l]=b.Util.bind(e,d);e=document.createElement("script");e.type="text/javascript";e.src=a+b.Util.getParamString(c);e.id=l;document.getElementsByTagName("head")[0].appendChild(e)}function k(a,c,e){var d=new XMLHttpRequest;d.onreadystatechange=function(){4===d.readyState&&(200!==
d.status&&304!==d.status?e(""):e(JSON.parse(d.response)))};d.open("GET",a+b.Util.getParamString(c),!0);d.setRequestHeader("Accept","application/json");d.send(null)}function y(a,b){return a.replace(/\{ *([\w_]+) *\}/g,function(a,c){var f=b[c];void 0===f?f="":"function"===typeof f&&(f=f(b));return u(f)})}b=b&&b.hasOwnProperty("default")?b["default"]:b;var x=0,w=/[&<>"'`]/g,v=/[&<>"'`]/,t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},q=b.Class.extend({options:{serviceUrl:"https://nominatim.openstreetmap.org/",
geocodingQueryParams:{},reverseQueryParams:{},htmlTemplate:function(a){a=a.address;var b=[];(a.road||a.building)&&b.push("{building} {road} {house_number}");(a.city||a.town||a.village||a.hamlet)&&b.push('<span class="'+(0<b.length?"leaflet-control-geocoder-address-detail":"")+'">{postcode} {city} {town} {village} {hamlet}</span>');(a.state||a.country)&&b.push('<span class="'+(0<b.length?"leaflet-control-geocoder-address-context":"")+'">{state} {country}</span>');return y(b.join("<br/>"),a,!0)}},initialize:function(a){b.Util.setOptions(this,
a)},geocode:function(a,c,e){k(this.options.serviceUrl+"search",b.extend({q:a,limit:5,format:"json",addressdetails:1},this.options.geocodingQueryParams),b.bind(function(a){for(var f=[],d=a.length-1;0<=d;d--){for(var h=a[d].boundingbox,g=0;4>g;g++)h[g]=parseFloat(h[g]);f[d]={icon:a[d].icon,name:a[d].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(a[d]):void 0,bbox:b.latLngBounds([h[0],h[2]],[h[1],h[3]]),center:b.latLng(a[d].lat,a[d].lon),properties:a[d]}}c.call(e,f)},this))},reverse:function(a,
c,e,d){k(this.options.serviceUrl+"reverse",b.extend({lat:a.lat,lon:a.lng,zoom:Math.round(Math.log(c/256)/Math.log(2)),addressdetails:1,format:"json"},this.options.reverseQueryParams),b.bind(function(a){var c=[];if(a&&a.lat&&a.lon){var f=b.latLng(a.lat,a.lon);c.push({name:a.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(a):void 0,center:f,bounds:b.latLngBounds(f,f),properties:a})}e.call(d,c)},this))}}),n=b.Control.extend({options:{showResultIcons:!1,collapsed:!0,expand:"touch",
position:"topright",placeholder:"Search...",errorMessage:"Nothing found.",suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0},includes:b.Evented.prototype||b.Mixin.Events,initialize:function(a){b.Util.setOptions(this,a);this.options.geocoder||(this.options.geocoder=new q);this._requestCount=0},onAdd:function(a){var c=b.DomUtil.create("div","leaflet-control-geocoder leaflet-bar"),e=b.DomUtil.create("button","leaflet-control-geocoder-icon",c),d=this._form=b.DomUtil.create("div","leaflet-control-geocoder-form",
c);this._map=a;this._container=c;e.innerHTML="&nbsp;";e.type="button";a=this._input=b.DomUtil.create("input","",d);a.type="text";a.placeholder=this.options.placeholder;this._errorElement=b.DomUtil.create("div","leaflet-control-geocoder-form-no-error",c);this._errorElement.innerHTML=this.options.errorMessage;this._alts=b.DomUtil.create("ul","leaflet-control-geocoder-alternatives leaflet-control-geocoder-alternatives-minimized",c);b.DomEvent.disableClickPropagation(this._alts);b.DomEvent.addListener(a,
"keydown",this._keydown,this);this.options.geocoder.suggest&&b.DomEvent.addListener(a,"input",this._change,this);b.DomEvent.addListener(a,"blur",function(){this.options.collapsed&&!this._preventBlurCollapse&&this._collapse();this._preventBlurCollapse=!1},this);this.options.collapsed?"click"===this.options.expand?b.DomEvent.addListener(c,"click",function(a){0===a.button&&2!==a.detail&&this._toggle()},this):b.Browser.touch&&"touch"===this.options.expand?b.DomEvent.addListener(c,"touchstart mousedown",
function(a){this._toggle();a.preventDefault();a.stopPropagation()},this):(b.DomEvent.addListener(c,"mouseover",this._expand,this),b.DomEvent.addListener(c,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),b.Browser.touch?b.DomEvent.addListener(c,"touchstart",function(){this._geocode()},this):b.DomEvent.addListener(c,"click",function(){this._geocode()},this));if(this.options.defaultMarkGeocode)this.on("markgeocode",this.markGeocode,this);this.on("startgeocode",
function(){b.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber")},this);this.on("finishgeocode",function(){b.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber")},this);b.DomEvent.disableClickPropagation(c);return c},_geocodeResult:function(a,c){if(c||1!==a.length)if(0<a.length){this._alts.innerHTML="";this._results=a;b.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized");for(var e=0;e<a.length;e++)this._alts.appendChild(this._createAlt(a[e],
e))}else b.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error");else this._geocodeResultSelected(a[0])},markGeocode:function(a){a=a.geocode||a;this._map.fitBounds(a.bbox);this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker);this._geocodeMarker=(new b.Marker(a.center)).bindPopup(a.html||a.name).addTo(this._map).openPopup();return this},_geocode:function(a){var b=++this._requestCount,e=a?"suggest":"geocode",d={input:this._input.value};this._lastGeocode=this._input.value;
a||this._clearResults();this.fire("start"+e,d);this.options.geocoder[e](this._input.value,function(c){b===this._requestCount&&(d.results=c,this.fire("finish"+e,d),this._geocodeResult(c,a))},this)},_geocodeResultSelected:function(a){this.fire("markgeocode",{geocode:a})},_toggle:function(){b.DomUtil.hasClass(this._container,"leaflet-control-geocoder-expanded")?this._collapse():this._expand()},_expand:function(){b.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded");this._input.select();
this.fire("expand")},_collapse:function(){b.DomUtil.removeClass(this._container,"leaflet-control-geocoder-expanded");b.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized");b.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error");this._input.blur();this.fire("collapse")},_clearResults:function(){b.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized");this._selection=null;b.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error")},
_createAlt:function(a,c){var e=b.DomUtil.create("li",""),d=b.DomUtil.create("a","",e),f=this.options.showResultIcons&&a.icon?b.DomUtil.create("img","",d):null,l=a.html?void 0:document.createTextNode(a.name);f&&(f.src=a.icon);e.setAttribute("data-result-index",c);a.html?d.innerHTML+=a.html:d.appendChild(l);b.DomEvent.addListener(e,"mousedown touchstart",function(c){this._preventBlurCollapse=!0;b.DomEvent.stop(c);this._geocodeResultSelected(a);b.DomEvent.on(e,"click",function(){this.options.collapsed?
this._collapse():this._clearResults()},this)},this);return e},_keydown:function(a){var c=this,e=function(a){c._selection&&(b.DomUtil.removeClass(c._selection,"leaflet-control-geocoder-selected"),c._selection=c._selection[0<a?"nextSibling":"previousSibling"]);c._selection||(c._selection=c._alts[0<a?"firstChild":"lastChild"]);c._selection&&b.DomUtil.addClass(c._selection,"leaflet-control-geocoder-selected")};switch(a.keyCode){case 27:this.options.collapsed&&this._collapse();break;case 38:e(-1);break;
case 40:e(1);break;case 13:this._selection?(a=parseInt(this._selection.getAttribute("data-result-index"),10),this._geocodeResultSelected(this._results[a]),this._clearResults()):this._geocode()}},_change:function(){var a=this._input.value;a!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),a.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout(b.bind(function(){this._geocode(!0)},this),this.options.suggestTimeout):this._clearResults())}}),z=b.Class.extend({initialize:function(a){this.key=
a},geocode:function(a,c,e){p("https://dev.virtualearth.net/REST/v1/Locations",{query:a,key:this.key},function(a){var f=[];if(0<a.resourceSets.length)for(var d=a.resourceSets[0].resources.length-1;0<=d;d--){var h=a.resourceSets[0].resources[d],g=h.bbox;f[d]={name:h.name,bbox:b.latLngBounds([g[0],g[1]],[g[2],g[3]]),center:b.latLng(h.point.coordinates)}}c.call(e,f)},this,"jsonp")},reverse:function(a,c,e,d){p("//dev.virtualearth.net/REST/v1/Locations/"+a.lat+","+a.lng,{key:this.key},function(a){for(var c=
[],f=a.resourceSets[0].resources.length-1;0<=f;f--){var g=a.resourceSets[0].resources[f],m=g.bbox;c[f]={name:g.name,bbox:b.latLngBounds([m[0],m[1]],[m[2],m[3]]),center:b.latLng(g.point.coordinates)}}e.call(d,c)},this,"jsonp")}}),A=b.Class.extend({options:{serviceUrl:"https://www.mapquestapi.com/geocoding/v1"},initialize:function(a,c){this._key=decodeURIComponent(a);b.Util.setOptions(this,c)},_formatName:function(){var a=[],b;for(b=0;b<arguments.length;b++)arguments[b]&&a.push(arguments[b]);return a.join(", ")},
geocode:function(a,c,e){k(this.options.serviceUrl+"/address",{key:this._key,location:a,limit:5,outFormat:"json"},b.bind(function(a){var f=[];if(a.results&&a.results[0].locations)for(var d=a.results[0].locations.length-1;0<=d;d--){var h=a.results[0].locations[d];var g=b.latLng(h.latLng);f[d]={name:this._formatName(h.street,h.adminArea4,h.adminArea3,h.adminArea1),bbox:b.latLngBounds(g,g),center:g}}c.call(e,f)},this))},reverse:function(a,c,e,d){k(this.options.serviceUrl+"/reverse",{key:this._key,location:a.lat+
","+a.lng,outputFormat:"json"},b.bind(function(a){var c=[];if(a.results&&a.results[0].locations)for(var f=a.results[0].locations.length-1;0<=f;f--){var g=a.results[0].locations[f];var m=b.latLng(g.latLng);c[f]={name:this._formatName(g.street,g.adminArea4,g.adminArea3,g.adminArea1),bbox:b.latLngBounds(m,m),center:m}}e.call(d,c)},this))}}),B=b.Class.extend({options:{serviceUrl:"https://api.tiles.mapbox.com/v4/geocode/mapbox.places-v1/",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(a,
c){b.setOptions(this,c);this.options.geocodingQueryParams.access_token=a;this.options.reverseQueryParams.access_token=a},geocode:function(a,c,e){var d=this.options.geocodingQueryParams;"undefined"!==typeof d.proximity&&d.proximity.hasOwnProperty("lat")&&d.proximity.hasOwnProperty("lng")&&(d.proximity=d.proximity.lng+","+d.proximity.lat);k(this.options.serviceUrl+encodeURIComponent(a)+".json",d,function(a){var d=[];if(a.features&&a.features.length)for(var f=0;f<=a.features.length-1;f++){var g=a.features[f];
var m=b.latLng(g.center.reverse());var k=g.hasOwnProperty("bbox")?b.latLngBounds(b.latLng(g.bbox.slice(0,2).reverse()),b.latLng(g.bbox.slice(2,4).reverse())):b.latLngBounds(m,m);d[f]={name:g.place_name,bbox:k,center:m}}c.call(e,d)})},suggest:function(a,b,e){return this.geocode(a,b,e)},reverse:function(a,c,e,d){k(this.options.serviceUrl+encodeURIComponent(a.lng)+","+encodeURIComponent(a.lat)+".json",this.options.reverseQueryParams,function(a){var c=[];if(a.features&&a.features.length)for(var f=0;f<=
a.features.length-1;f++){var g=a.features[f];var m=b.latLng(g.center.reverse());var k=g.hasOwnProperty("bbox")?b.latLngBounds(b.latLng(g.bbox.slice(0,2).reverse()),b.latLng(g.bbox.slice(2,4).reverse())):b.latLngBounds(m,m);c[f]={name:g.place_name,bbox:k,center:m}}e.call(d,c)})}}),C=b.Class.extend({options:{serviceUrl:"https://api.what3words.com/v2/"},initialize:function(a){this._accessToken=a},geocode:function(a,c,e){k(this.options.serviceUrl+"forward",{key:this._accessToken,addr:a.split(/\s+/).join(".")},
function(a){var d=[];if(a.hasOwnProperty("geometry")){var l=b.latLng(a.geometry.lat,a.geometry.lng);var h=b.latLngBounds(l,l);d[0]={name:a.words,bbox:h,center:l}}c.call(e,d)})},suggest:function(a,b,e){return this.geocode(a,b,e)},reverse:function(a,c,e,d){k(this.options.serviceUrl+"reverse",{key:this._accessToken,coords:[a.lat,a.lng].join()},function(a){var c=[];if(200==a.status.status){var f=b.latLng(a.geometry.lat,a.geometry.lng);var g=b.latLngBounds(f,f);c[0]={name:a.words,bbox:g,center:f}}e.call(d,
c)})}}),D=b.Class.extend({options:{serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(a,c){this._key=a;b.setOptions(this,c);this.options.serviceUrl=this.options.service_url||this.options.serviceUrl},geocode:function(a,c,e){a={address:a};this._key&&this._key.length&&(a.key=this._key);a=b.Util.extend(a,this.options.geocodingQueryParams);k(this.options.serviceUrl,a,function(a){var d=[];if(a.results&&a.results.length)for(var l=
0;l<=a.results.length-1;l++){var h=a.results[l];var g=b.latLng(h.geometry.location);var m=b.latLngBounds(b.latLng(h.geometry.viewport.northeast),b.latLng(h.geometry.viewport.southwest));d[l]={name:h.formatted_address,bbox:m,center:g,properties:h.address_components}}c.call(e,d)})},reverse:function(a,c,e,d){a={latlng:encodeURIComponent(a.lat)+","+encodeURIComponent(a.lng)};a=b.Util.extend(a,this.options.reverseQueryParams);this._key&&this._key.length&&(a.key=this._key);k(this.options.serviceUrl,a,function(a){var c=
[];if(a.results&&a.results.length)for(var f=0;f<=a.results.length-1;f++){var g=a.results[f];var m=b.latLng(g.geometry.location);var k=b.latLngBounds(b.latLng(g.geometry.viewport.northeast),b.latLng(g.geometry.viewport.southwest));c[f]={name:g.formatted_address,bbox:k,center:m,properties:g.address_components}}e.call(d,c)})}}),E=b.Class.extend({options:{serviceUrl:"https://photon.komoot.de/api/",reverseUrl:"https://photon.komoot.de/reverse/",nameProperties:"name street suburb hamlet town city state country".split(" ")},
initialize:function(a){b.setOptions(this,a)},geocode:function(a,c,e){a=b.extend({q:a},this.options.geocodingQueryParams);k(this.options.serviceUrl,a,b.bind(function(a){c.call(e,this._decodeFeatures(a))},this))},suggest:function(a,b,e){return this.geocode(a,b,e)},reverse:function(a,c,e,d){a=b.extend({lat:a.lat,lon:a.lng},this.options.reverseQueryParams);k(this.options.reverseUrl,a,b.bind(function(a){e.call(d,this._decodeFeatures(a))},this))},_decodeFeatures:function(a){var c=[],e;if(a&&a.features)for(e=
0;e<a.features.length;e++){var d=a.features[e];var f=d.geometry.coordinates;f=b.latLng(f[1],f[0]);var l=(l=d.properties.extent)?b.latLngBounds([l[1],l[0]],[l[3],l[2]]):b.latLngBounds(f,f);c.push({name:this._deocodeFeatureName(d),html:this.options.htmlTemplate?this.options.htmlTemplate(d):void 0,center:f,bbox:l,properties:d.properties})}return c},_deocodeFeatureName:function(a){var b;for(b=0;!e&&b<this.options.nameProperties.length;b++)var e=a.properties[this.options.nameProperties[b]];return e}}),
F=b.Class.extend({options:{serviceUrl:"https://search.mapzen.com/v1",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(a,c){b.Util.setOptions(this,c);this._apiKey=a;this._lastSuggest=0},geocode:function(a,c,e){var d=this;k(this.options.serviceUrl+"/search",b.extend({api_key:this._apiKey,text:a},this.options.geocodingQueryParams),function(a){c.call(e,d._parseResults(a,"bbox"))})},suggest:function(a,c,e){var d=this;k(this.options.serviceUrl+"/autocomplete",b.extend({api_key:this._apiKey,
text:a},this.options.geocodingQueryParams),b.bind(function(a){a.geocoding.timestamp>this._lastSuggest&&(this._lastSuggest=a.geocoding.timestamp,c.call(e,d._parseResults(a,"bbox")))},this))},reverse:function(a,c,e,d){var f=this;k(this.options.serviceUrl+"/reverse",b.extend({api_key:this._apiKey,"point.lat":a.lat,"point.lon":a.lng},this.options.reverseQueryParams),function(a){e.call(d,f._parseResults(a,"bounds"))})},_parseResults:function(a,c){var e=[];b.geoJson(a,{pointToLayer:function(a,c){return b.circleMarker(c)},
onEachFeature:function(a,f){var d={};if(f.getBounds){var h=f.getBounds();var g=h.getCenter()}else g=f.getLatLng(),h=b.latLngBounds(g,g);d.name=f.feature.properties.label;d.center=g;d[c]=h;d.properties=f.feature.properties;e.push(d)}});return e}}),G=b.Class.extend({options:{service_url:"http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"},initialize:function(a,c){b.setOptions(this,c);this._accessToken=a},geocode:function(a,c,e){a={SingleLine:a,outFields:"Addr_Type",forStorage:!1,maxLocations:10,
f:"json"};this._key&&this._key.length&&(a.token=this._key);k(this.options.service_url+"/findAddressCandidates",a,function(a){var d=[];if(a.candidates&&a.candidates.length)for(var l=0;l<=a.candidates.length-1;l++){var h=a.candidates[l];var g=b.latLng(h.location.y,h.location.x);var k=b.latLngBounds(b.latLng(h.extent.ymax,h.extent.xmax),b.latLng(h.extent.ymin,h.extent.xmin));d[l]={name:h.address,bbox:k,center:g}}c.call(e,d)})},suggest:function(a,b,e){return this.geocode(a,b,e)},reverse:function(a,c,
e,d){a={location:encodeURIComponent(a.lng)+","+encodeURIComponent(a.lat),distance:100,f:"json"};k(this.options.service_url+"/reverseGeocode",a,function(a){var c=[];if(a&&!a.error){var f=b.latLng(a.location.y,a.location.x);c.push({name:a.address.Match_addr,center:f,bounds:b.latLngBounds(f,f)})}e.call(d,c)})}}),H=b.Class.extend({options:{geocodeUrl:"http://geocoder.api.here.com/6.2/geocode.json",reverseGeocodeUrl:"http://reverse.geocoder.api.here.com/6.2/reversegeocode.json",app_id:"<insert your app_id here>",
app_code:"<insert your app_code here>",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(a){b.setOptions(this,a)},geocode:function(a,c,e){a={searchtext:a,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1};a=b.Util.extend(a,this.options.geocodingQueryParams);this.getJSON(this.options.geocodeUrl,a,c,e)},reverse:function(a,c,e,d){a={prox:encodeURIComponent(a.lat)+","+encodeURIComponent(a.lng),mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,
gen:9,jsonattributes:1};a=b.Util.extend(a,this.options.reverseQueryParams);this.getJSON(this.options.reverseGeocodeUrl,a,e,d)},getJSON:function(a,c,e,d){k(a,c,function(a){var c=[];if(a.response.view&&a.response.view.length)for(var f=0;f<=a.response.view[0].result.length-1;f++){var g=a.response.view[0].result[f].location;var k=b.latLng(g.displayPosition.latitude,g.displayPosition.longitude);var n=b.latLngBounds(b.latLng(g.mapView.topLeft.latitude,g.mapView.topLeft.longitude),b.latLng(g.mapView.bottomRight.latitude,
g.mapView.bottomRight.longitude));c[f]={name:g.address.label,bbox:n,center:k}}e.call(d,c)})}});n=b.Util.extend(n,{Nominatim:q,nominatim:function(a){return new b.Control.Geocoder.Nominatim(a)},Bing:z,bing:function(a){return new b.Control.Geocoder.Bing(a)},MapQuest:A,mapQuest:function(a,c){return new b.Control.Geocoder.MapQuest(a,c)},Mapbox:B,mapbox:function(a,c){return new b.Control.Geocoder.Mapbox(a,c)},What3Words:C,what3words:function(a){return new b.Control.Geocoder.What3Words(a)},Google:D,google:function(a,
c){return new b.Control.Geocoder.Google(a,c)},Photon:E,photon:function(a){return new b.Control.Geocoder.Photon(a)},Mapzen:F,mapzen:function(a,c){return new b.Control.Geocoder.Mapzen(a,c)},ArcGis:G,arcgis:function(a,c){return new b.Control.Geocoder.ArcGis(a,c)},HERE:H,here:function(a){return new b.Control.Geocoder.HERE(a)}});b.Util.extend(b.Control,{Geocoder:n,geocoder:function(a){return new b.Control.Geocoder(a)}});return n}(L);