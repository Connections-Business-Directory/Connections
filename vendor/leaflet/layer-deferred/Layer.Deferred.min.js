L.DeferredLayer=L.LayerGroup.extend({options:{js:[],init:null},_script_cache:{},initialize:function(a){L.Util.setOptions(this,a);L.LayerGroup.prototype.initialize.apply(this);this._loaded=!1},onAdd:function(a){L.LayerGroup.prototype.onAdd.apply(this,[a]);this._loaded||this._loadScripts(this.options.js.reverse(),L.Util.bind(function(){this._loaded=!0;var a=this.options.init();a&&this.addLayer(a)},this))},_loadScripts:function(a,e,f){function g(){h._loadScripts(a,e,f)}if(!a||0===a.length)return e(f);
var h=this,d=a.pop();var b=this._script_cache[d];if(void 0===b){b={url:d,wait:[]};var c=document.createElement("script");c.src=d;c.type="text/javascript";c.onload=function(){b.e.readyState="completed";var a;for(a=0;a<b.wait.length;a++)b.wait[a]()};b.e=c;document.getElementsByTagName("head")[0].appendChild(c)}b.wait.push(g);"completed"===b.e.readyState&&g();this._script_cache[d]=b}});